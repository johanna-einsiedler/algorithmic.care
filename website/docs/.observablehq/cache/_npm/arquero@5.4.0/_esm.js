/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/arquero@5.4.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Data as t,Vector as e,makeBuilder as n,Type as r,DataType as o,Utf8 as s,Uint64 as a,Uint32 as i,Uint16 as u,Uint8 as c,TimeSecond as l,TimeNanosecond as f,TimeMillisecond as p,TimeMicrosecond as m,Null as d,IntervalYearMonth as h,IntervalDayTime as g,Int64 as y,Int32 as _,Int16 as v,Int8 as b,Float64 as w,Float32 as x,Float16 as M,Dictionary as $,DateMillisecond as E,DateDay as j,Bool as k,Binary as N,Field as A,FixedSizeList as O,List as S,Struct as T,Table as C,tableFromIPC as I,tableToIPC as U}from"../apache-arrow@17.0.0/_esm.js";import{parse as F}from"../acorn@8.12.1/_esm.js";var D=Array.isArray;function R(t){return null!=t?D(t)?t:[t]:[]}function z(t){return t<0?`count() + ${t}`:t}class q{constructor(t){t&&(this._params=t)}params(t){return arguments.length?(t&&(this._params={...this._params,...t}),this):this._params}reify(t){return this.__reify(this,t)}count(t){return this.__count(this,t)}derive(t,e){return this.__derive(this,t,e)}filter(t){return this.__filter(this,t)}slice(t,e){return this.filter(function(t=0,e=1/0){return`${z(t)} < row_number() && row_number() <= ${z(e)}`}(t,e)).reify()}groupby(...t){return this.__groupby(this,t.flat())}orderby(...t){return this.__orderby(this,t.flat())}relocate(t,e){return this.__relocate(this,R(t),e)}rename(...t){return this.__rename(this,t.flat())}rollup(t){return this.__rollup(this,t)}sample(t,e){return this.__sample(this,t,e)}select(...t){return this.__select(this,t.flat())}ungroup(){return this.__ungroup(this)}unorder(){return this.__unorder(this)}dedupe(...t){return this.__dedupe(this,t.flat())}impute(t,e){return this.__impute(this,t,e)}fold(t,e){return this.__fold(this,t,e)}pivot(t,e,n){return this.__pivot(this,t,e,n)}spread(t,e){return this.__spread(this,t,e)}unroll(t,e){return this.__unroll(this,t,e)}lookup(t,e,...n){return this.__lookup(this,t,e,n.flat())}join(t,e,n,r){return this.__join(this,t,e,n,r)}join_left(t,e,n,r){const o={...r,left:!0,right:!1};return this.__join(this,t,e,n,o)}join_right(t,e,n,r){const o={...r,left:!1,right:!0};return this.__join(this,t,e,n,o)}join_full(t,e,n,r){const o={...r,left:!0,right:!0};return this.__join(this,t,e,n,o)}cross(t,e,n){return this.__cross(this,t,e,n)}semijoin(t,e){return this.__semijoin(this,t,e)}antijoin(t,e){return this.__antijoin(this,t,e)}concat(...t){return this.__concat(this,t.flat())}union(...t){return this.__union(this,t.flat())}intersect(...t){return this.__intersect(this,t.flat())}except(...t){return this.__except(this,t.flat())}}function P(t){throw Error(t)}function L(t){return"number"==typeof t}function V(t){return"function"==typeof t}function B(t,e){const n=Array(t);if(V(e))for(let r=0;r<t;++r)n[r]=e(r);else n.fill(e);return n}class G extends q{constructor(t,e,n,r,o,s,a){super(a),this._names=Object.freeze(t),this._data=n,this._total=e,this._nrows=r?r.count():e,this._mask=e!==this._nrows&&r||null,this._group=o||null,this._order=s||null}create(t){P("Not implemented")}get[Symbol.toStringTag](){if(!this._names)return"Object";const t=this.numRows()+" row"+(1!==this.numRows()?"s":"");return`Table: ${this.numCols()+" col"+(1!==this.numCols()?"s":"")} x ${t}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(t){return t?this._names.filter(t):this._names.slice()}columnName(t){return this._names[t]}columnIndex(t){return this._names.indexOf(t)}columnArray(t,e){return this.array(t,e)}array(t,e){P("Not implemented")}*values(t){const e=this.getter(t),n=this.numRows();for(let t=0;t<n;++t)yield e(t)}get(t,e=0){P("Not implemented")}getter(t){P("Not implemented")}objects(t){P("Not implemented")}object(t){P("Not implemented")}[Symbol.iterator](){P("Not implemented")}print(t={}){L(t)?t={limit:t}:null==t.limit&&(t.limit=10);const e=this.objects({...t,grouped:!1}),n=`${this[Symbol.toStringTag]}. Showing ${e.length} rows.`;return console.log(n),console.table(e),this}indices(t=!0){if(this._index)return this._index;const e=this.numRows(),n=new Uint32Array(e),r=this.isOrdered(),o=this.mask();let s=-1;if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))n[++s]=t;else for(let t=0;t<e;++t)n[++s]=t;if(t&&r){const t=this._order,e=this._data;n.sort(((n,r)=>t(n,r,e)))}return!t&&r||(this._index=n),n}partitions(t=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(t)];const{keys:e,size:n}=this._group,r=B(n,(()=>[])),o=this._index,s=this.mask(),a=this.numRows();if(o&&this.isOrdered())for(let t,n=0;n<a;++n)t=o[n],r[e[t]].push(t);else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))r[e[t]].push(t);else for(let t=0;t<a;++t)r[e[t]].push(t);if(t&&!o&&this.isOrdered()){const t=this._order,e=this._data;for(let o=0;o<n;++o)r[o].sort(((n,r)=>t(n,r,e)))}return!t&&this.isOrdered()||(this._partitions=r),r}scan(t,e,n=1/0,r=0){const o=this._mask,s=this._nrows,a=this._data;let i=r||0;if(i>s)return;const u=Math.min(s,i+n),c=()=>i=this._total;if(e&&this.isOrdered()||o&&this._index){const e=this.indices(),n=this._data;for(;i<u;++i)t(e[i],n,c)}else if(o){let e=u-i+1;for(i=o.nth(i);--e&&i>-1;i=o.next(i+1))t(i,a,c)}else for(;i<u;++i)t(i,a,c)}slice(t=0,e=1/0){if(this.isGrouped())return super.slice(t,e);const n=[],r=this.numRows();return t=Math.max(0,t+(t<0?r:0)),e=Math.min(r,Math.max(0,e+(e<0?r:0))),this.scan((t=>n.push(t)),!0,e-t,t),this.reify(n)}reduce(t){return this.__reduce(this,t)}}class J{constructor(t){this.data=t}get length(){return this.data.length}get(t){return this.data[t]}[Symbol.iterator](){return this.data[Symbol.iterator]()}}let H=function(t){return t&&V(t.get)?t:new J(t)};function W(t){return t instanceof Date}function Y(t){return t===Object(t)}function Q(t){return t instanceof RegExp}function K(t){return"string"==typeof t}function Z(t,e){const n=e=>P(`Illegal argument type: ${e||typeof t}`);return t instanceof Map?X(t.entries(),e):W(t)?n("Date"):Q(t)?n("RegExp"):K(t)?n():D(t)?function(t,e){const n=t.length,r={},o=t=>r[t]=Array(n);if(n){const r=(e=e||Object.keys(t[0])).map(o),s=r.length;for(let o=0;o<n;++o){const n=t[o];for(let t=0;t<s;++t)r[t][o]=n[e[t]]}}else e&&e.forEach(o);return r}(t,e):V(t[Symbol.iterator])?function(t,e){const n={},r=t=>n[t]=[];let o,s;for(const n of t){o||(o=(e=e||Object.keys(n)).map(r),s=o.length);for(let t=0;t<s;++t)o[t].push(n[e[t]])}!o&&e&&e.forEach(r);return n}(t,e):Y(t)?X(Object.entries(t),e):n()}function X(t,e=["key","value"]){const n=[],r=[];for(const[e,o]of t)n.push(e),r.push(o);const o={};return e[0]&&(o[e[0]]=n),e[1]&&(o[e[1]]=r),o}const{hasOwnProperty:tt}=Object.prototype;function et(t,e){return tt.call(t,e)}function nt(t){return t?new rt({...t.data()},t.columnNames()):new rt}class rt{constructor(t,e){this.data=t||{},this.names=e||[]}add(t,e){return this.has(t)||this.names.push(t+""),this.data[t]=e}has(t){return et(this.data,t)}new(){return this.filter=null,this.groups=this.groups||null,this.order=null,this}groupby(t){return this.groups=t,this}}var ot=void 0;const st=Object.getPrototypeOf(Int8Array);function at(t){return t instanceof st}function it(t){return D(t)||at(t)}function ut(t){return null!=t&&t==t}const ct=t=>it(t)||K(t);var lt={compact:t=>it(t)?t.filter((t=>ut(t))):t,concat:(...t)=>[].concat(...t),includes:(t,e,n)=>!!ct(t)&&t.includes(e,n),indexof:(t,e)=>ct(t)?t.indexOf(e):-1,join:(t,e)=>it(t)?t.join(e):ot,lastindexof:(t,e)=>ct(t)?t.lastIndexOf(e):-1,length:t=>ct(t)?t.length:0,pluck:(t,e)=>it(t)?t.map((t=>ut(t)?t[e]:ot)):ot,reverse:t=>it(t)?t.slice().reverse():K(t)?t.split("").reverse().join(""):ot,slice:(t,e,n)=>ct(t)?t.slice(e,n):ot};function ft(t,e,n="0"){const r=t+"",o=r.length;return o<e?Array(e-o+1).join(n)+r:r}const pt=t=>(t<10?"0":"")+t,mt=t=>t<0?"-"+ft(-t,6):t>9999?"+"+ft(t,6):ft(t,4);function dt(t,e,n,r,o,s,a,i,u){const c=i?"Z":"";return mt(t)+"-"+pt(e+1)+"-"+pt(n)+(!u||a?"T"+pt(r)+":"+pt(o)+":"+pt(s)+"."+ft(a,3)+c:s?"T"+pt(r)+":"+pt(o)+":"+pt(s)+c:o||r||!i?"T"+pt(r)+":"+pt(o)+c:"")}function ht(t,e){return isNaN(t)?"Invalid Date":dt(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),!1,e)}function gt(t,e){return isNaN(t)?"Invalid Date":dt(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds(),!0,e)}const yt=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function _t(t){return t.match(yt)&&!isNaN(Date.parse(t))}const vt=864e5,bt=6048e5,wt=new Date,xt=new Date,Mt=t=>(wt.setTime("string"==typeof t?function(t,e=Date.parse){return _t(t)?e(t):t}(t):t),wt);var $t={format_date:(t,e)=>ht(Mt(t),!e),format_utcdate:(t,e)=>gt(Mt(t),!e),timestamp:t=>+Mt(t),year:t=>Mt(t).getFullYear(),quarter:t=>Math.floor(Mt(t).getMonth()/3),month:t=>Mt(t).getMonth(),date:t=>Mt(t).getDate(),dayofweek:t=>Mt(t).getDay(),hours:t=>Mt(t).getHours(),minutes:t=>Mt(t).getMinutes(),seconds:t=>Mt(t).getSeconds(),milliseconds:t=>Mt(t).getMilliseconds(),utcyear:t=>Mt(t).getUTCFullYear(),utcquarter:t=>Math.floor(Mt(t).getUTCMonth()/3),utcmonth:t=>Mt(t).getUTCMonth(),utcdate:t=>Mt(t).getUTCDate(),utcdayofweek:t=>Mt(t).getUTCDay(),utchours:t=>Mt(t).getUTCHours(),utcminutes:t=>Mt(t).getUTCMinutes(),utcseconds:t=>Mt(t).getUTCSeconds(),utcmilliseconds:t=>Mt(t).getUTCMilliseconds(),datetime:function(t,e,n,r,o,s,a){return arguments.length?new Date(t,e||0,null==n?1:n,r||0,o||0,s||0,a||0):new Date(Date.now())},dayofyear:function(t){xt.setTime(+t),xt.setHours(0,0,0,0),wt.setTime(+xt),wt.setMonth(0),wt.setDate(1);const e=6e4*(xt.getTimezoneOffset()-wt.getTimezoneOffset());return Math.floor(1+(xt-wt-e)/vt)},week:function(t,e){const n=e||0;xt.setTime(+t),xt.setDate(xt.getDate()-(xt.getDay()+7-n)%7),xt.setHours(0,0,0,0),wt.setTime(+t),wt.setMonth(0),wt.setDate(1),wt.setDate(1-(wt.getDay()+7-n)%7),wt.setHours(0,0,0,0);const r=6e4*(xt.getTimezoneOffset()-wt.getTimezoneOffset());return Math.floor((xt-wt+1-r)/bt)},utcdatetime:function(t,e,n,r,o,s,a){return arguments.length?new Date(Date.UTC(t,e||0,null==n?1:n,r||0,o||0,s||0,a||0)):new Date(Date.now())},utcdayofyear:function(t){xt.setTime(+t),xt.setUTCHours(0,0,0,0);const e=Date.UTC(xt.getUTCFullYear(),0,1);return Math.floor(1+(xt-e)/vt)},utcweek:function(t,e){const n=e||0;return xt.setTime(+t),xt.setUTCDate(xt.getUTCDate()-(xt.getUTCDay()+7-n)%7),xt.setUTCHours(0,0,0,0),wt.setTime(+t),wt.setUTCMonth(0),wt.setUTCDate(1),wt.setUTCDate(1-(wt.getUTCDay()+7-n)%7),wt.setUTCHours(0,0,0,0),Math.floor((xt-wt+1)/bt)},now:Date.now};function Et(t,e){return null!=t&&null!=e&&t==t&&e==e&&(t===e||(W(t)||W(e)?+t==+e:Q(t)&&Q(e)?t+""==e+"":!(!Y(t)||!Y(e))&&function(t,e){if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;if(t.length||e.length)return jt(t,e);const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(n.sort(),r.sort(),!jt(n,r,((t,e)=>t===e)))return!1;const o=n.length;for(let r=0;r<o;++r){const o=n[r];if(!Et(t[o],e[o]))return!1}return!0}(t,e)))}function jt(t,e,n=Et){const r=t.length;if(r!==e.length)return!1;for(let o=0;o<r;++o)if(!n(t[o],e[o]))return!1;return!0}var kt={parse_json:t=>JSON.parse(t),to_json:t=>JSON.stringify(t)};let Nt=Math.random;function At(){return Nt()}function Ot(t){Nt=ut(t)&&isFinite(t=+t)?function(t){const e=1664525,n=1013904223,r=1/4294967296;return t=0|(0<=t&&t<1?t/r:Math.abs(t)),()=>r*((t=e*t+n|0)>>>0)}(t):Math.random}function St(t){return t instanceof Map}function Tt(t){return St(t)||function(t){return t instanceof Set}(t)}function Ct(t){return Array.from(t)}var It={has:(t,e)=>Tt(t)?t.has(e):null!=t&&et(t,e),keys:t=>St(t)?Ct(t.keys()):null!=t?Object.keys(t):[],values:t=>Tt(t)?Ct(t.values()):null!=t?Object.values(t):[],entries:t=>Tt(t)?Ct(t.entries()):null!=t?Object.entries(t):[],object:t=>t?Object.fromEntries(t):ot};function Ut(t,e,n){let r=arguments.length;t=+t,e=+e,n=r<2?(e=t,t=0,1):r<3?1:+n,r=0|Math.max(0,Math.ceil((e-t)/n));const o=new Array(r);for(let e=0;e<r;++e)o[e]=t+e*n;return o}var Ft={bin:function(t,e,n,r,o){return null==t?null:t<e?-1/0:t>n?1/0:(t=Math.max(e,Math.min(t,n)),e+r*Math.floor(1e-14+(t-e)/r+(o||0)))},equal:Et,recode:function(t,e,n){if(e instanceof Map){if(e.has(t))return e.get(t)}else if(et(e,t))return e[t];return void 0!==n?n:t},sequence:Ut,...lt,...$t,...kt,...{random:At,is_nan:Number.isNaN,is_finite:Number.isFinite,abs:Math.abs,cbrt:Math.cbrt,ceil:Math.ceil,clz32:Math.clz32,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,fround:Math.fround,greatest:Math.max,least:Math.min,log:Math.log,log10:Math.log10,log1p:Math.log1p,log2:Math.log2,pow:Math.pow,round:Math.round,sign:Math.sign,sqrt:Math.sqrt,trunc:Math.trunc,degrees:t=>180*t/Math.PI,radians:t=>Math.PI*t/180,acos:Math.acos,acosh:Math.acosh,asin:Math.asin,asinh:Math.asinh,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,cos:Math.cos,cosh:Math.cosh,sin:Math.sin,sinh:Math.sinh,tan:Math.tan,tanh:Math.tanh},...It,...{parse_date:t=>null==t?t:new Date(t),parse_float:t=>null==t?t:Number.parseFloat(t),parse_int:(t,e)=>null==t?t:Number.parseInt(t,e),endswith:(t,e,n)=>null!=t&&String(t).endsWith(e,n),match:(t,e,n)=>{const r=null==t?t:String(t).match(e);return null==n||null==r?r:"number"==typeof n?r[n]:r.groups?r.groups[n]:null},normalize:(t,e)=>null==t?t:String(t).normalize(e),padend:(t,e,n)=>null==t?t:String(t).padEnd(e,n),padstart:(t,e,n)=>null==t?t:String(t).padStart(e,n),upper:t=>null==t?t:String(t).toUpperCase(),lower:t=>null==t?t:String(t).toLowerCase(),repeat:(t,e)=>null==t?t:String(t).repeat(e),replace:(t,e,n)=>null==t?t:String(t).replace(e,String(n)),substring:(t,e,n)=>null==t?t:String(t).substring(e,n),split:(t,e,n)=>null==t?[]:String(t).split(e,n),startswith:(t,e,n)=>null!=t&&String(t).startsWith(e,n),trim:t=>null==t?t:String(t).trim()}};function Dt(t){return"bigint"==typeof t}function Rt(t){return void 0===t?t+"":Dt(t)?t+"n":JSON.stringify(t)}function zt(t,e=[],n=[]){return new qt(t,R(e),R(n))}class qt{constructor(t,e,n){this.name=t,this.fields=e,this.params=n}toString(){const t=[...this.fields.map((t=>`d[${Rt(t)}]`)),...this.params.map(Rt)];return`d => op.${this.name}(${t})`}toObject(){return{expr:this.toString(),func:!0}}}const Pt=t=>zt("any",t),Lt=()=>zt("count"),Vt=t=>zt("array_agg",t),Bt=t=>zt("array_agg_distinct",t),Gt=(t,e)=>zt("map_agg",[t,e]),Jt=(t,e)=>zt("object_agg",[t,e]),Ht=(t,e)=>zt("entries_agg",[t,e]);var Wt={...Ft,row_object:(...t)=>zt("row_object",null,t.flat()),count:Lt,any:Pt,array_agg:Vt,array_agg_distinct:Bt,object_agg:Jt,map_agg:Gt,entries_agg:Ht,valid:t=>zt("valid",t),invalid:t=>zt("invalid",t),distinct:t=>zt("distinct",t),mode:t=>zt("mode",t),sum:t=>zt("sum",t),product:t=>zt("product",t),mean:t=>zt("mean",t),average:t=>zt("average",t),variance:t=>zt("variance",t),variancep:t=>zt("variancep",t),stdev:t=>zt("stdev",t),stdevp:t=>zt("stdevp",t),min:t=>zt("min",t),max:t=>zt("max",t),quantile:(t,e)=>zt("quantile",t,e),median:t=>zt("median",t),covariance:(t,e)=>zt("covariance",[t,e]),covariancep:(t,e)=>zt("covariancep",[t,e]),corr:(t,e)=>zt("corr",[t,e]),bins:(t,e,n,r)=>zt("bins",t,[e,n,r]),row_number:()=>zt("row_number"),rank:()=>zt("rank"),avg_rank:()=>zt("avg_rank"),dense_rank:()=>zt("dense_rank"),percent_rank:()=>zt("percent_rank"),cume_dist:()=>zt("cume_dist"),ntile:t=>zt("ntile",null,t),lag:(t,e,n)=>zt("lag",t,[e,n]),lead:(t,e,n)=>zt("lead",t,[e,n]),first_value:t=>zt("first_value",t),last_value:t=>zt("last_value",t),nth_value:(t,e)=>zt("nth_value",t,e),fill_down:(t,e)=>zt("fill_down",t,e),fill_up:(t,e)=>zt("fill_up",t,e)};function Yt(t,e,n,r){const o="map"===r||!0===r?Gt:"entries"===r?Ht:"object"===r?Jt:P('groups option must be "map", "entries", or "object".'),{names:s}=t.groups(),a=function(t,e){t=Tt(t)?t:new Set(t);let n=e,r=0;for(;t.has(n);)n=e+ ++r;return n}(t.columnNames(),"_");let i=t.select().reify(e).create({data:{[a]:n}}).rollup({[a]:Vt(a)});for(let t=s.length;--t>=0;)i=i.groupby(s.slice(0,t)).rollup({[a]:o(s[t],a)});return i.get(a)}const Qt="ArrowFunctionExpression",Kt="FunctionExpression",Zt="Identifier",Xt="Literal",te="MemberExpression",ee="ObjectExpression",ne="ObjectPattern",re="Property",oe="Column",se="Constant",ae="Dictionary",ie="Parameter",ue=(t,e)=>{const n=he[t.type];return n?n(t,e):P(`Unsupported expression construct: ${t.type}`)},ce=(t,e)=>"("+ue(t.left,e)+" "+t.operator+" "+ue(t.right,e)+")",le=(t,e)=>"("+pe(t.params,e)+")=>"+ue(t.body,e),fe=(t,e)=>ue(t.callee,e)+"("+pe(t.arguments,e)+")",pe=(t,e,n=",")=>t.map((t=>ue(t,e))).join(n),me=t=>t.computed?`[${Rt(t.name)}]`:`.${t.name}`,de=(t,e,n)=>{const r=t.table||"";return`data${r}${me(t)}.${n}(${e.index}${r})`},he={Constant:t=>t.raw,Column:(t,e)=>de(t,e,"get"),Dictionary:(t,e)=>de(t,e,"key"),Function:t=>`fn.${t.name}`,Parameter:t=>`$${me(t)}`,Op:(t,e)=>`op(${Rt(t.name)},${e.op||e.index})`,Literal:t=>t.raw,Identifier:t=>t.name,TemplateLiteral:(t,e)=>{const{quasis:n,expressions:r}=t,o=r.length;let s=n[0].value.raw;for(let t=0;t<o;)s+="${"+ue(r[t],e)+"}"+n[++t].value.raw;return"`"+s+"`"},MemberExpression:(t,e)=>{const n=!t.computed,r=ue(t.object,e),o=ue(t.property,e);return r+(n?"."+o:"["+o+"]")},CallExpression:fe,NewExpression:(t,e)=>"new "+fe(t,e),ArrayExpression:(t,e)=>"["+pe(t.elements,e)+"]",AssignmentExpression:ce,BinaryExpression:ce,LogicalExpression:ce,UnaryExpression:(t,e)=>"("+t.operator+ue(t.argument,e)+")",ConditionalExpression:(t,e)=>"("+ue(t.test,e)+"?"+ue(t.consequent,e)+":"+ue(t.alternate,e)+")",ObjectExpression:(t,e)=>"({"+pe(t.properties,e)+"})",Property:(t,e)=>{const n=ue(t.key,e);return(t.computed?`[${n}]`:n)+":"+ue(t.value,e)},ArrowFunctionExpression:le,FunctionExpression:le,FunctionDeclaration:le,ArrayPattern:(t,e)=>"["+pe(t.elements,e)+"]",ObjectPattern:(t,e)=>"{"+pe(t.properties,e)+"}",VariableDeclaration:(t,e)=>t.kind+" "+pe(t.declarations,e,","),VariableDeclarator:(t,e)=>ue(t.id,e)+"="+ue(t.init,e),SpreadElement:(t,e)=>"..."+ue(t.argument,e),BlockStatement:(t,e)=>"{"+pe(t.body,e,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(t,e)=>ue(t.expression,e),IfStatement:(t,e)=>"if ("+ue(t.test,e)+")"+ue(t.consequent,e)+(t.alternate?" else "+ue(t.alternate,e):""),SwitchStatement:(t,e)=>"switch ("+ue(t.discriminant,e)+") {"+pe(t.cases,e,"")+"}",SwitchCase:(t,e)=>(t.test?"case "+ue(t.test,e):"default")+": "+pe(t.consequent,e,";")+";",ReturnStatement:(t,e)=>"return "+ue(t.argument,e),Program:(t,e)=>ue(t.body[0],e)};function ge(t,e={index:"row"}){return ue(t,e)}function ye(t){const e=typeof t;return"string"===e?`"${t}"`:"object"===e&&t?W(t)?+t:D(t)||at(t)?`[${t.map(ye)}]`:Q(t)?t+"":function(t){let e="{",n=-1;for(const r in t)++n>0&&(e+=","),e+=`"${r}":${ye(t[r])}`;return e+="}",e}(t):t}function _e(t,e){const n=t.length;return 1===n?(e,n)=>ye(t[0](e,n)):(r,o)=>{let s="";for(let a=0;a<n;++a){a>0&&(s+="|");const n=t[a](r,o);if(e&&(null==n||n!=n))return null;s+=ye(n)}return s}}function ve(){}function be(t){return t.init=t.init||ve,t.add=t.add||ve,t.rem=t.rem||ve,t}function we(t,e){return t.product_v=!1,t.product=e}var xe={count:{create:()=>be({value:t=>t.count}),param:[]},array_agg:{create:()=>be({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[1]},object_agg:{create:()=>be({init:t=>t.values=!0,value:t=>Object.fromEntries(t.list.values())}),param:[2]},map_agg:{create:()=>be({init:t=>t.values=!0,value:t=>new Map(t.list.values())}),param:[2]},entries_agg:{create:()=>be({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[2]},any:{create:()=>be({add:(t,e)=>{null==t.any&&(t.any=e)},value:t=>t.valid?t.any:ot}),param:[1]},valid:{create:()=>be({value:t=>t.valid}),param:[1]},invalid:{create:()=>be({value:t=>t.count-t.valid}),param:[1]},distinct:{create:()=>({init:t=>t.distinct=function(){const t=new Map;return{count:()=>t.size,values:()=>Array.from(t.values(),(t=>t.v)),increment(e){const n=ye(e),r=t.get(n);r?++r.n:t.set(n,{v:e,n:1})},decrement(e){const n=ye(e),r=t.get(n);1===r.n?t.delete(n):--r.n},forEach(e){t.forEach((({v:t,n:n})=>e(t,n)))}}}(),value:t=>t.distinct.count()+(t.valid===t.count?0:1),add:(t,e)=>t.distinct.increment(e),rem:(t,e)=>t.distinct.decrement(e)}),param:[1]},array_agg_distinct:{create:()=>be({value:t=>t.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>be({value:t=>{let e=ot,n=0;return t.distinct.forEach(((t,r)=>{r>n&&(n=r,e=t)})),e}}),param:[1],req:["distinct"]},sum:{create:()=>({init:t=>t.sum=0,value:t=>t.valid?t.sum:ot,add:(t,e)=>Dt(e)?0===t.sum?t.sum=e:t.sum+=e:t.sum+=+e,rem:(t,e)=>t.sum-=e}),param:[1]},product:{create:()=>({init:t=>we(t,1),value:t=>t.valid?t.product_v?we(t,function(t,e=0,n=t.length){let r=t[e++];for(let o=e;o<n;++o)r*=t[o];return r}(t.list.values())):t.product:void 0,add:(t,e)=>Dt(e)&&1===t.product?t.product=e:t.product*=e,rem:(t,e)=>0==e||e===1/0||e===-1/0?t.product_v=!0:t.product/=e}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:t=>t.mean=0,value:t=>t.valid?t.mean:ot,add:(t,e)=>{t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid},rem:(t,e)=>{t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean}}),param:[1]},average:{create:()=>be({value:t=>t.valid?t.mean:ot}),param:[1],req:["mean"]},variance:{create:()=>({init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):ot,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean)}),param:[1],req:["mean"]},variancep:{create:()=>be({value:t=>t.valid>1?t.dev/t.valid:ot}),param:[1],req:["variance"]},stdev:{create:()=>be({value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):ot}),param:[1],req:["variance"]},stdevp:{create:()=>be({value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):ot}),param:[1],req:["variance"]},min:{create:()=>({init:t=>t.min=ot,value:t=>t.min=Number.isNaN(t.min)?t.list.min():t.min,add:(t,e)=>{(e<t.min||t.min===ot)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:t=>t.max=ot,value:t=>t.max=Number.isNaN(t.max)?t.list.max():t.max,add:(t,e)=>{(e>t.max||t.max===ot)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:t=>be({value:e=>e.list.quantile(t)}),param:[1,1],req:["array_agg"]},median:{create:()=>be({value:t=>t.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:t=>{t.cov=t.mean_x=t.mean_y=t.dev_x=t.dev_y=0},value:t=>t.valid>1?t.cov/(t.valid-1):ot,add:(t,e,n)=>{const r=e-t.mean_x,o=n-t.mean_y;t.mean_x+=r/t.valid,t.mean_y+=o/t.valid;const s=n-t.mean_y;t.dev_x+=r*(e-t.mean_x),t.dev_y+=o*s,t.cov+=r*s},rem:(t,e,n)=>{const r=e-t.mean_x,o=n-t.mean_y;t.mean_x-=t.valid?r/t.valid:t.mean_x,t.mean_y-=t.valid?o/t.valid:t.mean_y;const s=n-t.mean_y;t.dev_x-=r*(e-t.mean_x),t.dev_y-=o*s,t.cov-=r*s}}),param:[2]},covariancep:{create:()=>be({value:t=>t.valid>1?t.cov/t.valid:ot}),param:[2],req:["covariance"]},corr:{create:()=>be({value:t=>t.valid>1?t.cov/(Math.sqrt(t.dev_x)*Math.sqrt(t.dev_y)):ot}),param:[2],req:["covariance"]},bins:{create:(t,e,n,r)=>be({value:o=>function(t,e,n=15,r=!0,o=0,s){const a=Math.LN10;if(null==s){const r=Math.ceil(Math.log(n)/a),i=e-t||Math.abs(t)||1,u=[5,2];for(s=Math.max(o,Math.pow(10,Math.round(Math.log(i)/a)-r));Math.ceil(i/s)>n;)s*=10;const c=u.length;for(let t=0;t<c;++t){const e=s/u[t];e>=o&&i/e<=n&&(s=e)}}if(r){let n=Math.log(s);const r=n>=0?0:1+~~(-n/a),o=Math.pow(10,-r-1);n=Math.floor(t/s+o)*s,t=t<n?n-s:n,e=Math.ceil(e/s)*s}return[t,e===t?t+s:e,s]}(o.min,o.max,t,e,n,r)}),param:[1,4],req:["min","max"]}};const Me={create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?t=n+1:t}}},param:[]},$e={create(){let t;return{init:()=>t=0,value:e=>{const{index:n,peer:r,size:o}=e;let s=n;if(t<s){for(;s+1<o&&r(s+1);)++s;t=s}return(1+t)/o}}},param:[]};var Ee={row_number:{create:()=>({init:ve,value:t=>t.index+1}),param:[]},rank:Me,avg_rank:{create(){let t,e;return{init:()=>(t=-1,e=1),value:n=>{const r=n.index;if(r>=t){for(e=t=r+1;n.peer(t);e+=++t);e/=t-r}return e}}},param:[]},dense_rank:{create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?++t:t}}},param:[]},percent_rank:{create(){const{init:t,value:e}=Me.create();return{init:t,value:t=>(e(t)-1)/(t.size-1)}},param:[]},cume_dist:$e,ntile:{create(t){(t=+t)>0||P("ntile num must be greater than zero.");const{init:e,value:n}=$e.create();return{init:e,value:e=>Math.ceil(t*n(e))}},param:[0,1]},lag:{create:(t,e=ot)=>(t=+t||1,{init:ve,value:(n,r)=>{const o=n.index-t;return o>=0?n.value(o,r):e}}),param:[1,2]},lead:{create:(t,e=ot)=>(t=+t||1,{init:ve,value:(n,r)=>{const o=n.index+t;return o<n.size?n.value(o,r):e}}),param:[1,2]},first_value:{create:()=>({init:ve,value:(t,e)=>t.value(t.i0,e)}),param:[1]},last_value:{create:()=>({init:ve,value:(t,e)=>t.value(t.i1-1,e)}),param:[1]},nth_value:{create:t=>((t=+t)>0||P("nth_value nth must be greater than zero."),{init:ve,value:(e,n)=>{const r=e.i0+(t-1);return r<e.i1?e.value(r,n):ot}}),param:[1,1]},fill_down:{create(t=ot){let e;return{init:()=>e=t,value:(t,n)=>{const r=t.value(t.index,n);return ut(r)?e=r:e}}},param:[1,1]},fill_up:{create(t=ot){let e,n;return{init:()=>(e=t,n=-1),value:(r,o)=>r.index<=n?e:(n=function(t,e,n){for(const r=t.size;n<r;++n)if(ut(t.value(n,e)))return n;return-1}(r,o,r.index))>=0?e=r.value(n,o):(n=r.size,e=t)}},param:[1,1]}};function je(t){return et(xe,t)}function ke(t){return et(Ee,t)}function Ne(t){return et(Ft,t)||"row_object"===t}function Ae(t){return je(t)&&xe[t]}function Oe(t){return ke(t)&&Ee[t]}function Se(t,e,n){return t=`"use strict"; return ${t};`,Function("fn","$",t)(e,n)}var Te={escape:(t,e,n)=>Se(t,e,n),expr:(t,e)=>Se(`(row,data,op)=>${t}`,Ft,e),expr2:(t,e)=>Se(`(row0,data0,row,data)=>${t}`,Ft,e),join:(t,e)=>Se(`(row1,data1,row2,data2)=>${t}`,Ft,e),param:(t,e)=>Se(t,Ft,e)};const Ce={"==":1,"!=":1,"===":1,"!==":1};function Ie(t,e,n=0,r,o){if(t.type=oe,t.name=e,t.table=n,o&&r&&V(r.keyFor)){const e=Ce[o.operator]?o.left===t?o.right:o.left:o.callee&&"equal"===o.callee.name?o.arguments[o.arguments[0]===t?1:0]:null;e&&e.type===Xt&&function(t,e,n,r){r<0?(t.type=Xt,t.value=!1,t.raw="false"):(e.type=ae,n.value=r,n.raw=r+"")}(o,t,e,r.keyFor(e.value))}return t}function Ue(t){return D(t)?t:St(t)?t.entries():t?Object.entries(t):[]}const Fe="row_object";function De(t,e){t.type=ee;const n=t.properties=[];for(const t of Ue(e)){const[e,r]=D(t)?t:[t,t];n.push({type:re,key:{type:Xt,raw:Rt(r)},value:Ie({computed:!0},e)})}return t}function Re(t){return ge(De({},t))}function ze(t){return Te.expr(Re(t))}function qe(t,e=1){return(t*e+63&-64||64)/e}function Pe(t,e,n=t.BYTES_PER_ELEMENT){return new t(qe(e,n))}function Le(e){return e instanceof t?e:new t(e.type,0,e.length,e.nulls,e.buffers,null,e.dict)}const Ve=new TextEncoder;const Be=Ve.encodeInto?function(t,e,n){return Ve.encodeInto(n,t.subarray(e)).written}:function(t,e,n){const r=Ve.encode(n);return t.set(r,e),r.length};function Ge(t,e){const n=Pe(t.ArrayType,e);return{set(t,e){n[e]=t},data:()=>({type:t,length:e,buffers:[null,n]})}}function Je(t,e){const n=Pe(t.ArrayType,e/8);return{set(t,e){t&&(n[e>>3]|=1<<e%8)},data:()=>({type:t,length:e,buffers:[null,n]})}}function He(t,e){const n=Pe(t.ArrayType,e);return{set(t,e){n[e]=t/864e5|0},data:()=>({type:t,length:e,buffers:[null,n]})}}function We(t,e){const n=Pe(t.ArrayType,e<<1);return{set(t,e){const r=e<<1;n[r]=t%4294967296|0,n[r+1]=t/4294967296|0},data:()=>({type:t,length:e,buffers:[null,n]})}}function Ye(t,e){const n=[],r=Pe(t.indices.ArrayType,e),o=Object.create(null);let s=-1,a=0;return{set(t,e){const i=String(t);let u=o[i];void 0===u&&(a+=i.length,o[i]=u=++s,n.push(i)),r[e]=u},data:()=>({type:t,length:e,buffers:[null,r],dict:Qe(t.dictionary,n,a)})}}function Qe(t,n,r){const o=function(t,e,n){const r=Pe(Int32Array,e+1),o=Pe(Uint8Array,3*n);let s=0;return{set(t,e){s+=Be(o,s,t),r[e+1]=s},data:()=>{const n=qe(s),a=o.length>n?o.subarray(0,n):o;return{type:t,length:e,buffers:[r,a]}}}}(t,n.length,r);return n.forEach(o.set),s=o.data(),new e([Le(s)]);var s}function Ke(t,e,o=!0){let s;switch(t.typeId){case r.Int:s=t.bitWidth<64?Ge:null;break;case r.Float:s=t.precision>0?Ge:null;break;case r.Dictionary:s=t.dictionary.typeId===r.Utf8&&t.indices.typeId===r.Int&&t.indices.bitWidth<64?Ye:null;break;case r.Bool:s=Je;break;case r.Date:s=t.unit?We:He}return null==s?function(t){const e=n({type:t,nullValues:[null,void 0]});return{set(t,n){e.set(n,t)},data:()=>e.finish().flush()}}(t):o?function(t,e){const n=Pe(Uint8Array,e/8);let r=0;return{set(e,o){null==e?++r:(t.set(e,o),n[o>>3]|=1<<o%8)},data:()=>{const e=t.data();return r&&(e.nulls=r,e.buffers[2]=n),e}}}(s(t,e),e):s(t,e)}function Ze(t,e,n,r,o=!0){const s=Ke(r,t,o);return e(n,s.set),Le(s.data())}function Xe(t){if(t instanceof o||null==t)return t;switch(t){case r.Binary:return new N;case r.Bool:return new k;case r.DateDay:return new j;case r.DateMillisecond:case r.Date:return new E;case r.Dictionary:return new $(new s,new _);case r.Float16:return new M;case r.Float32:return new x;case r.Float64:case r.Float:return new w;case r.Int8:return new b;case r.Int16:return new v;case r.Int32:case r.Int:return new _;case r.Int64:return new y;case r.IntervalDayTime:return new g;case r.Interval:case r.IntervalYearMonth:return new h;case r.Null:return new d;case r.TimeMicrosecond:return new m;case r.TimeMillisecond:case r.Time:return new p;case r.TimeNanosecond:return new f;case r.TimeSecond:return new l;case r.Uint8:return new c;case r.Uint16:return new u;case r.Uint32:return new i;case r.Uint64:return new a;case r.Utf8:return new s;default:P(`Unsupported type code: ${Rt(t)}. Use a data type constructor instead?`)}}function tn(t,e){const n=en();return t(e,n.add),n}function en(){const t={count:0,nulls:0,bools:0,nums:0,ints:0,bigints:0,min:1/0,max:-1/0,digits:0,dates:0,utcdays:0,strings:0,strlen:0,arrays:0,minlen:1/0,maxlen:0,structs:0,add(e){if(++t.count,null==e)return void++t.nulls;const n=typeof e;if("string"===n)++t.strings;else if("number"===n)++t.nums,e<t.min&&(t.min=e),e>t.max&&(t.max=e),Number.isInteger(e)&&++t.ints;else if("boolean"===n)++t.bools;else if("object"===n)if(W(e))++t.dates,0===(r=e).getUTCHours()&&0===r.getUTCMinutes()&&0===r.getUTCSeconds()&&0===r.getUTCMilliseconds()&&++t.utcdays;else if(it(e)){++t.arrays,e.length<t.minlen&&(t.minlen=e.length),e.length>t.maxlen&&(t.maxlen=e.length);const n=t.array_prof||(t.array_prof=en());e.forEach(n.add)}else{++t.structs;const n=t.struct_prof||(t.struct_prof={});for(const t in e){(n[t]||(n[t]=en())).add(e[t])}}else"bigint"===n&&(++t.bigints,e<t.min&&(t.min=e),e>t.max&&(t.max=e));var r},type:()=>Xe(function(t){const e=t.count-t.nulls;if(0===e)return r.Null;if(t.ints===e){const e=Math.max(Math.abs(t.min)-1,t.max);return t.min<0?e>=2**31?r.Float64:e<128?r.Int8:e<32768?r.Int16:r.Int32:e>=2**32?r.Float64:e<256?r.Uint8:e<65536?r.Uint16:r.Uint32}if(t.nums===e)return r.Float64;if(t.bigints===e){const e=-t.min>t.max?-t.min-1n:t.max;return t.min<0?e<2**63?r.Int64:P(`BigInt exceeds 64 bits: ${e}`):t.max<2**64?r.Uint64:P(`BigInt exceeds 64 bits: ${t.max}`)}if(t.bools===e)return r.Bool;if(t.utcdays===e)return r.DateDay;if(t.dates===e)return r.DateMillisecond;if(t.arrays===e){const e=A.new("value",t.array_prof.type(),!0);return t.minlen===t.maxlen?new O(t.minlen,e):new S(e)}if(t.structs===e){const e=t.struct_prof;return new T(Object.keys(e).map((t=>A.new(t,e[t].type(),!0))))}if(t.strings>0)return r.Dictionary;P("Type inference failure")}(t))};return t}function nn(t,e,n,r,o,s=!0){if(!(o=Xe(o))){const t=tn(r,e);s=t.nulls>0,o=t.type()}return Ze(n,r,e,o,s)}function rn(t,n,r,o,s,l=!0){s=Xe(s);const f=t.column(n),p=!(t.isFiltered()||t.isOrdered()),m=(d=f)instanceof e?d:d.vector instanceof e?d.vector:null;var d;if(m&&p&&on(m.type,s))return m;const h=f.data;if(at(h)){const t=function(t){const e={Float32Array:x,Float64Array:w,Int8Array:b,Int16Array:v,Int32Array:_,Uint8Array:c,Uint16Array:u,Uint32Array:i,BigInt64Array:y,BigUint64Array:a},n=e[t.constructor.name];return n?new n:null}(h);if(p&&t&&on(t,s))return function(t,e){const n=t.length,r=qe(n,t.BYTES_PER_ELEMENT);let o=t;return n!==r&&(o=new t.constructor(r),o.set(t)),Le({type:e,length:n,buffers:[null,o]})}(h,t);s=s||t,l=!1}if(!s){const t=tn(o,f);l=t.nulls>0,s=t.type()}return Ze(r,o,f,s,l)}function on(t,e){return!t||!e||t.compareTo(e)}function sn(t,e,n){const r=Math.min(t.length,n+e);return(e,o)=>{for(let s=n;s<r;++s)o(t[s][e],s)}}function an(t,e,n){const r=0===n&&t.numRows()<=e&&!t.isFiltered()&&!t.isOrdered();return(o,s)=>{let a=-1;r&&it(o.data)?o.data.forEach(s):t.scan((t=>s(o.get(t),++a)),!0,e,n)}}const un=()=>P("Apache Arrow not imported, see https://github.com/uwdata/arquero#usage");function cn(t,e={}){const{types:n={}}=e,{dataFrom:r,names:o,nrows:s,scan:a}=function(t,e){const{columns:n,limit:r=1/0,offset:o=0}=e,s=V(n)?n(t):D(n)?n:null;if(D(t))return{dataFrom:nn,names:s||Object.keys(t[0]),nrows:Math.min(r,t.length-o),scan:sn(t,r,o)};if(function(t){return t&&V(t.reify)}(t))return{dataFrom:rn,names:s||t.columnNames(),nrows:Math.min(r,t.numRows()-o),scan:an(t,r,o)};P("Unsupported input data type")}(t,e),i={};o.forEach((e=>{const o=r(t,e,s,a,n[e]);o.length!==s&&P("Column length mismatch"),i[e]=o}));return new(function(){try{return C}catch(t){un()}}())(i)}function ln(t,e){return V(e)?e(t):e||t.columnNames()}function fn(t,e,n){const r=n.format||{},o=n.align||{},s={},a={};return e.forEach((e=>{const i=function(t,e={}){let n=0,r=0,o=0,s=0,a=0,i=0;return t((t=>{if(++n,null==t)return void++r;const e=typeof t;if("object"===e&&W(t))++o,0===(u=t).getUTCHours()&&0===u.getUTCMinutes()&&0===u.getUTCSeconds()&&0===u.getUTCMilliseconds()&&++s;else if("number"===e&&(++a,t==t&&(0|t)!==t)){const e=t+"",n=e.indexOf(".");if(n>=0){const t=e.indexOf("e"),r=t>0?t:e.length;i=Math.max(i,r-n-1)}}var u})),{align:(r+a+o)/n>.5?"r":"l",format:{utc:o===s,digits:Math.min(i,e.maxdigits||6)}}}(function(t,e){const n=t.column(e);return e=>t.scan((t=>e(n.get(t))))}(t,e),n);a[e]=o[e]||i.align,s[e]=r[e]||i.format})),{align:a,format:s}}function pn(t,e,n=100,r,o){const s=t.data(),a=e.length;t.scan((t=>{o.row(t);for(let n=0;n<a;++n){const r=e[n];o.cell(s[e[n]].get(t),r,n)}}),!0,n,r)}function mn(t,e={}){if(V(e))return e(t)+"";const n=typeof t;if("object"===n){if(W(t))return e.utc?gt(t):ht(t);{const n=JSON.stringify(t,((t,e)=>at(e)?Array.from(e):e)),r=e.maxlen||30;return n.length>r?n.slice(0,28)+"…"+("["===n[0]?"]":"}"):n}}if("number"===n){const n=e.digits||0;let r;return 0!==t&&((r=Math.abs(t))>=1e18||r<Math.pow(10,-n))?t.toExponential(n):t.toFixed(n)}return t+""}function dn(t,e,n={}){for(const r in t)n[r]=e(t[r],r);return n}function hn(t,e={}){const n=ln(t,e.columns),{align:r,format:o}=fn(t,n,e),s=function(t){return dn(t.style,(t=>V(t)?t:()=>t))}(e),a=e.null,i=(t,e)=>mn(t,e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=a?(t,e)=>null==t?a(t):i(t,e):i;let c=-1,l=-1;const f=(t,e,n)=>{const o=n?(t=>"c"===t?"center":"r"===t?"right":"left")(r[e]):"",a=s[t]&&s[t](e,l,c)||"",i=(o?`text-align: ${o};`+(a?" ":""):"")+a;return`<${t}${i?` style="${i}"`:""}>`};let p=f("table")+f("thead")+f("tr",c)+n.map((t=>`${f("th",t,1)}${t}</th>`)).join("")+"</tr></thead>"+f("tbody");return pn(t,n,e.limit,e.offset,{row(t){c=t,p+=(++l?"</tr>":"")+f("tr")},cell(t,e){p+=f("td",e,1)+u(t,o[e])+"</td>"}}),p+"</tr></tbody></table>"}function gn(t,e=!0,n=!1){return void 0===t||t?e:n}const yn=t=>W(t)?gt(t,!0):t;function _n(t,e){for(const[n,r]of Ue(e))t.set(n,r);return t}function vn(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function bn(t,e,n=new Map){return K(e=L(e)?t.columnName(e):e)?n.set(e,e):D(e)?e.forEach((e=>bn(t,e,n))):V(e)?bn(t,e(t),n):Y(e)?_n(n,e):P(`Invalid column selection: ${Rt(e)}`),n}function wn(t,e){return t.toObject=e,t}function xn(t){return D(t)?t.map(xn):t&&t.toObject?t.toObject():t}function Mn(){return wn((t=>t.columnNames()),(()=>({all:[]})))}function $n(...t){return t=t.flat(),wn((e=>{const n=bn(e,t);return e.columnNames((t=>!n.has(t)))}),(()=>({not:xn(t)})))}function En(t,e){return wn((n=>{let r=L(t)?t:n.columnIndex(t),o=L(e)?e:n.columnIndex(e);if(o<r){const t=o;o=r,r=t}return n.columnNames().slice(r,o+1)}),(()=>({range:[t,e]})))}function jn(t){return K(t)&&(t=RegExp(vn(t))),wn((e=>e.columnNames((e=>t.test(e)))),(()=>({matches:[t.source,t.flags]})))}function kn(t){return jn(RegExp("^"+vn(t)))}function Nn(t){return jn(RegExp(vn(t)+"$"))}class An extends G{static from(t,e){return new An(Z(t,e),e)}static new(t,e){if(t instanceof An)return t;const n={},r=[];for(const[e,o]of Ue(t))n[e]=o,r.push(e);return new An(n,e||r)}constructor(t,e,n,r,o,s){dn(t,H,t);super(e=e||Object.keys(t),e.length?t[e[0]].length:0,t,n,r,o,s)}create({data:t,names:e,filter:n,groups:r,order:o}){const s=void 0!==n?n:this.mask();return new An(t||this._data,e||(t?null:this._names),s,void 0!==r?r:function(t,e){if(!t||!e)return t;const{keys:n,rows:r,size:o}=t,s=new Int32Array(o);e.scan((t=>s[n[t]]=1));const a=s.reduce(((t,e)=>t+e),0);if(a===o)return t;const i=Array(a);let u=0;for(let t=0;t<o;++t)s[t]&&(i[s[t]=u++]=r[t]);const c=new Uint32Array(n.length);return e.scan((t=>c[t]=s[n[t]])),{...t,keys:c,rows:i,size:u}}(this._group,n&&s),void 0!==o?o:this._order,this._params)}assign(...t){const e=this.numRows(),n=this.reify(),r=nt(n).groupby(n.groups());return t.forEach((t=>{(t=An.new(t)).numRows()!==e&&P("Assign row counts do not match"),(t=t.reify()).columnNames((e=>r.add(e,t.column(e))))})),this.create(r.new())}columns(){return this._data}column(t){return this._data[t]}columnAt(t){return this._data[this._names[t]]}array(t,e=Array){const n=this.column(t),r=new e(this.numRows());let o=-1;return this.scan((t=>r[++o]=n.get(t)),!0),r}get(t,e=0){const n=this.column(t);return this.isFiltered()||this.isOrdered()?n.get(this.indices()[e]):n.get(e)}getter(t){const e=this.column(t),n=this.isFiltered()||this.isOrdered()?this.indices():null;return n?t=>e.get(n[t]):e?t=>e.get(t):P(`Unrecognized column: ${t}`)}object(t=0){return On(this)(t)}objects(t={}){const{grouped:e,limit:n,offset:r}=t,o=ze(bn(this,t.columns||Mn())),s=[];if(this.scan(((t,e)=>s.push(o(t,e))),!0,n,r),e&&this.isGrouped()){const t=[];return this.scan((e=>t.push(e)),!0,n,r),Yt(this,t,s,e)}return s}*[Symbol.iterator](){const t=On(this),e=this.numRows();for(let n=0;n<e;++n)yield t(n)}reify(t){const e=t?t.length:this.numRows(),n=this._names;let r,o;if(!t&&!this.isOrdered()){if(!this.isFiltered())return this;e===this.totalRows()&&(r=this.data())}if(!r){const a=t?e=>t.forEach(e):t=>this.scan(t,!0),i=n.length;r={};for(let t=0;t<i;++t){const o=n[t],i=this.column(o),u=r[o]=new(at((s=i).data)?s.data.constructor:Array)(e);let c=-1;a((t=>u[++c]=i.get(t)))}this.isGrouped()&&(o=function(t,e,n,r){const{keys:o,rows:s,size:a}=t;let i=s,u=a,c=null;if(n){c=new Int32Array(a),e((t=>c[o[t]]=1));const t=c.reduce(((t,e)=>t+e),0);if(t!==a){i=Array(t),u=0;for(let t=0;t<a;++t)c[t]&&(i[c[t]=u++]=s[t])}}let l=-1;const f=new Uint32Array(r);return e(u!==a?t=>f[++l]=c[o[t]]:t=>f[++l]=o[t]),{...t,keys:f,rows:i,size:u}}(this.groups(),a,!!t,e))}var s;return this.create({data:r,names:n,groups:o,filter:null,order:null})}transform(...t){return t.flat().reduce(((t,e)=>e(t)),this)}toArrow(t){return cn(this,t)}toArrowBuffer(t){return function(t,e={}){const{format:n,...r}=e;if(!["stream","file"].includes(n||"stream"))throw Error("Unrecognised output format");return U(cn(t,r),n)}(this,t)}toCSV(t){return function(t,e={}){const n=ln(t,e.columns),r=e.format||{},o=e.delimiter||",",s=new RegExp(`["${o}\n\r]`),a=t=>null==t?"":W(t)?gt(t,!0):s.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t,i=n.map(a);let u="";return pn(t,n,e.limit||1/0,e.offset,{row(){u+=i.join(o)+"\n"},cell(t,e,n){i[n]=a(r[e]?r[e](t):t)}}),u+i.join(o)}(this,t)}toHTML(t){return hn(this,t)}toJSON(t){return function(t,e={}){const n=gn(e.schema),r=e.format||{},o=ln(t,e.columns);let s="{";return n&&(s+='"schema":{"fields":'+JSON.stringify(o.map((t=>({name:t}))))+'},"data":{'),o.forEach(((n,o)=>{s+=(o?",":"")+JSON.stringify(n)+":[";const a=t.column(n),i=r[n]||yn;let u=-1;t.scan((t=>{const e=a.get(t);s+=(++u?",":"")+JSON.stringify(i(e))}),!0,e.limit,e.offset),s+="]"})),s+"}"+(n?"}":"")}(this,t)}toMarkdown(t){return function(t,e={}){const n=ln(t,e.columns),{align:r,format:o}=fn(t,n,e),s=t=>t.replace(/\|/g,"\\|");let a="|"+n.map(s).join("|")+"|\n|"+n.map((t=>{return"c"===(e=r[t])?":-:":"r"===e?"-:":":-";var e})).join("|")+"|";return pn(t,n,e.limit,e.offset,{row(){a+="\n|"},cell(t,e){a+=s(mn(t,o[e]))+"|"}}),a+"\n"}(this,t)}}function On(t){let e=t._builder;if(!e){const n=ze(t.columnNames()),r=t.data();if(t.isOrdered()||t.isFiltered()){const o=t.indices();e=t=>n(o[t],r)}else e=t=>n(t,r);t._builder=e}return e}class Sn{constructor(t){this._outputs=t}size(){return this._outputs.length}outputs(){return this._outputs}init(){return{}}add(){}rem(){}write(){}}function Tn(t,e,n,r){const o=n[t.type]||n.Default;if(o&&!1===o(t,e,r))return;const s=zn[t.type];s&&s(t,e,n)}const Cn=(t,e,n)=>{Tn(t.argument,e,n,t)},In=(t,e,n)=>{Tn(t.left,e,n,t),Tn(t.right,e,n,t)},Un=(t,e,n)=>{Tn(t.test,e,n,t),Tn(t.consequent,e,n,t),t.alternate&&Tn(t.alternate,e,n,t)},Fn=(t,e,n)=>{Rn(t.params,e,n,t),Tn(t.body,e,n,t)},Dn=(t,e,n)=>{Tn(t.callee,e,n,t),Rn(t.arguments,e,n,t)},Rn=(t,e,n,r)=>{t.forEach((t=>Tn(t,e,n,r)))},zn={TemplateLiteral:(t,e,n)=>{Rn(t.expressions,e,n,t),Rn(t.quasis,e,n,t)},MemberExpression:(t,e,n)=>{Tn(t.object,e,n,t),Tn(t.property,e,n,t)},CallExpression:Dn,NewExpression:Dn,ArrayExpression:(t,e,n)=>{Rn(t.elements,e,n,t)},AssignmentExpression:In,AwaitExpression:Cn,BinaryExpression:In,LogicalExpression:In,UnaryExpression:Cn,UpdateExpression:Cn,ConditionalExpression:Un,ObjectExpression:(t,e,n)=>{Rn(t.properties,e,n,t)},Property:(t,e,n)=>{Tn(t.key,e,n,t),Tn(t.value,e,n,t)},ArrowFunctionExpression:Fn,FunctionExpression:Fn,FunctionDeclaration:Fn,VariableDeclaration:(t,e,n)=>{Rn(t.declarations,e,n,t)},VariableDeclarator:(t,e,n)=>{Tn(t.id,e,n,t),Tn(t.init,e,n,t)},SpreadElement:(t,e,n)=>{Tn(t.argument,e,n,t)},BlockStatement:(t,e,n)=>{Rn(t.body,e,n,t)},ExpressionStatement:(t,e,n)=>{Tn(t.expression,e,n,t)},IfStatement:Un,ForStatement:(t,e,n)=>{Tn(t.init,e,n,t),Tn(t.test,e,n,t),Tn(t.update,e,n,t),Tn(t.body,e,n,t)},WhileStatement:(t,e,n)=>{Tn(t.test,e,n,t),Tn(t.body,e,n,t)},DoWhileStatement:(t,e,n)=>{Tn(t.body,e,n,t),Tn(t.test,e,n,t)},SwitchStatement:(t,e,n)=>{Tn(t.discriminant,e,n,t),Rn(t.cases,e,n,t)},SwitchCase:(t,e,n)=>{t.test&&Tn(t.test,e,n,t),Rn(t.consequent,e,n,t)},ReturnStatement:Cn,Program:(t,e,n)=>{Tn(t.body[0],e,n,t)}};function qn(t){delete t.start,delete t.end,delete t.optional}function Pn(t){qn(t),delete t.object,delete t.property,delete t.computed,t.table||delete t.table}function Ln(t,e){return e&&e.type===t}const Vn="Escaped functions are not valid as rollup or pivot values.";function Bn(t,e,n){t.aggronly&&P(Vn);const r="(row,data)=>fn("+Re(t.table.columnNames())+",$)";return{escape:Te.escape(r,(o=e.expr,V(o)?o:()=>o),n)};var o}var Gn={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};const Jn={ecmaVersion:11},Hn="$",Wn="d",Yn="d1",Qn="d2",Kn=t=>(e,n)=>n.error(e,t+" not allowed"),Zn=Kn("Aggregate function"),Xn=Kn("Window function"),tr="Invalid argument",er="Invalid column reference",nr=er+" (must be input to an aggregate function)",rr="Invalid function call",or="Invalid operator parameter",sr="Unsupported destructuring pattern",ar="Table expressions do not support closures",ir="Use aq.escape(fn) to use a function as-is (including closures)",ur=`\nNote: ${ar}. ${ir}, or use table.params({ name: value }) to define dynamic parameters.`,cr=`\nNote: ${ar}. ${ir}, or use aq.addFunction(name, fn) to add new op functions.`,lr=`The ${Fe} method is not valid in multi-table expressions.`;function fr(t,e){const n=function(t){try{const e=t.field?function(t){const e=JSON.stringify(t+"");return t.table?`(a,b)=>b[${e}]`:`d=>d[${e}]`}(t):D(t)?Rt(t):t;return F(`expr=(${e})`,Jn).body[0].expression.right}catch(e){P("Expression parse error: "+(t+""))}}(e);let r=t.root=n;return t.spec=e,t.tuple=null,t.tuple1=null,t.tuple2=null,t.$param=null,t.$op=0,t.scope=new Set,t.paramsRef=new Map,t.columnRef=new Map,!function(t){return Ln(Kt,t)||Ln(Qt,t)}(r)?t.join?(t.scope.add(t.tuple1=Yn),t.scope.add(t.tuple2=Qn),t.scope.add(t.$param=Hn)):(t.scope.add(t.tuple=Wn),t.scope.add(t.$param=Hn)):(!function(t,e){t.generator&&Kn("Generator functions")(t,e);t.async&&Kn("Async functions")(t,e);const{params:n}=t,r=n.length,o=t=>(n,r)=>e.columnRef.set(n,[r,t]),s=(t,n)=>e.paramsRef.set(t,n);r&&(e.join?(hr(e,n[0],"tuple1",o(1)),r>1&&hr(e,n[1],"tuple2",o(2)),r>2&&hr(e,n[2],"$param",s)):(hr(e,n[0],"tuple",o(0)),r>1&&hr(e,n[1],"$param",s)));e.root=t.body}(r,t),r=r.body),Tn(r,t,pr),t.root}const pr={FunctionDeclaration:Kn("Function definitions"),ForStatement:Kn("For loops"),ForOfStatement:Kn("For-of loops"),ForInStatement:Kn("For-in loops"),WhileStatement:Kn("While loops"),DoWhileStatement:Kn("Do-while loops"),AwaitExpression:Kn("Await expressions"),ArrowFunctionExpression:Kn("Function definitions"),AssignmentExpression:Kn("Assignments"),FunctionExpression:Kn("Function definitions"),NewExpression:Kn('Use of "new"'),UpdateExpression:Kn("Update expressions"),VariableDeclarator(t,e){Er(t.id,e)},Identifier(t,e,n){_r(t,e,n)&&!e.scope.has(t.name)&&e.error(t,"Invalid variable reference",ur)},CallExpression(t,e){const n=gr(t.callee),r=Ae(n)||Oe(n);if(r){if((e.join||!1===e.aggregate)&&je(n)&&Zn(t,e),(e.join||!1===e.window)&&ke(n)&&Xn(t,e),e.$op=1,e.ast)$r(t,n,e),t.arguments.forEach((t=>Tn(t,e,dr)));else{const o=e.op(function(t,e,n,r){const o=[],s=[],a=e.param[0]||0,i=a+(e.param[1]||0);return r.forEach(((e,n)=>{n<a?(Tn(e,t,dr),o.push(t.field(e))):n<i?(Tn(e,t,dr),s.push(t.param(e))):t.error(e,or)})),{name:n,fields:o,params:s,...t.spec.window||{}}}(e,r,n,t.arguments));Object.assign(t,{type:"Op",name:o.id})}return e.$op=0,!1}Ne(n)?$r(t,n,e):e.error(t,rr,cr)},MemberExpression(t,e,n){const{object:r,property:o}=t;if(!Ln(Zt,r))return;const{name:s}=r;if(yr(t)&&Ln(Zt,o)&&et(Gn,o.name))return void Mr(t,o.name);const a=s===e.tuple?0:s===e.tuple1?1:s===e.tuple2?2:-1;return a>=0?mr(t,a,e,vr,n):s===e.$param?mr(t,a,e,wr):void(e.paramsRef.has(s)?xr(t,e.paramsRef.get(s)):e.columnRef.has(s)?br(r,s,e,t):et(e.params,s)&&xr(r,s))}};function mr(t,e,n,r,o){const{property:s,computed:a}=t;let i;if(a)if(Ln(Xt,s))i=s.value;else try{Tn(s,n,pr,t),i=n.param(s)}catch(e){n.error(t,"Invalid member expression")}else i=s.name;return r(t,i,e,n,o),!1}const dr={...pr,VariableDeclarator:Kn("Variable declaration in operator call"),Identifier(t,e,n){_r(t,e,n)&&e.error(t,"Variable not accessible in operator call")},CallExpression(t,e){const n=gr(t.callee);Ne(n)?$r(t,n,e):e.error(t,rr,cr)}};function hr(t,e,n,r){Ln(Zt,e)?(t.scope.add(e.name),t[n]=e.name):Ln(ne,e)&&e.properties.forEach((e=>{const n=Ln(Zt,e.key)?e.key.name:Ln(Xt,e.key)?e.key.value:t.error(e,tr);Ln(Zt,e.value)||t.error(e.value,sr),r(e.value.name,n)}))}function gr(t){return Ln(Zt,t)?t.name:Ln(te,t)?yr(t)?function(t){return"max"===t?"greatest":"min"===t?"least":t}(t.property.name):t.property.name:null}function yr(t){return Ln(Zt,t.object)&&"Math"===t.object.name}function _r(t,e,n){const{name:r}=t;if(Ln(te,n)&&n.property===t);else if(Ln(re,n)&&n.key===t);else if(e.paramsRef.has(r))xr(t,e.paramsRef.get(r));else if(e.columnRef.has(r))br(t,r,e,n);else if(et(e.params,r))xr(t,r);else{if(!et(Gn,r))return!0;Mr(t,r)}}function vr(t,e,n,r,o){const s=0===n?r.table:n>0?r.join[n-1]:null,a=s&&s.column(e);s&&!a&&r.error(t,er),r.aggronly&&!r.$op&&r.error(t,nr),Ie(t,e,n,a,o)}function br(t,e,n,r){const[o,s]=n.columnRef.get(e);vr(t,o,s,n,r)}function wr(t,e,n,r){r.params&&!et(r.params,e)&&r.error(t,"Invalid param reference"),xr(t,e)}function xr(t,e){t.type=ie,t.name=e}function Mr(t,e){t.type=se,t.name=e,t.raw=Gn[e]}function $r(t,e,n){if(e===Fe){const e=n.table;e||n.error(t,lr),De(t,t.arguments.length?t.arguments.map((t=>{const r=n.param(t),o=L(r)?e.columnName(r):r;return e.column(o)||n.error(t,er),o})):e.columnNames())}else t.callee={type:"Function",name:e}}function Er(t,e){Ln(Zt,t)?e.scope.add(t.name):Ln("ArrayPattern",t)?t.elements.forEach((t=>Er(t,e))):Ln(ne,t)?t.properties.forEach((t=>Er(t.value,e))):e.error(t.id,"Unsupported variable declaration")}const jr={[oe]:1,Op:1};function kr(t,e={}){const n=e.generate||ge,r=e.compiler||Te,o=function(t){return(t.table?Nr(t.table):t.join?{...Nr(t.join[1]),...Nr(t.join[0])}:{})||{}}(e),s={},a={},i=[],u=[];let c=0,l=-1;const f=e.join?r.join:1==e.index?r.expr2:r.expr,p={op(t){const e=function(t){let e=`${t.name}(${t.fields.concat(t.params).join(",")})`;if(t.frame){e+=`[${t.frame.map((t=>Number.isFinite(t)?Math.abs(t):-1))},${!!t.peers}]`}return e}(t);return a[e]||(t.id=++l,a[e]=t)},field(t){const e=n(t);return s[e]||(s[e]=++c)},param:t=>Ln(Xt,t)?t.value:r.param(n(t),o),value(t,r){i.push(t);const s=r.escape||(e.ast?function(t){return Tn(t,null,{Column:Pn,Constant:Pn,Default:qn}),t}(r):f(n(r),o));u.push(s),jr[r.type]&&s!==r&&Y(s)&&(s.field=r.name)},error(t,e,n=""){const r=t.start-6,o=t.end-6;P(`${e}: "${String(p.spec).slice(r,o)}"${n}`)}};Object.assign(p,e,{params:o});for(const[e,n]of Ue(t))p.value(e+"",n.escape?Bn(p,n,o):fr(p,n));if(e.ast)return{names:i,exprs:u};const m=[];for(const t in s)m[s[t]]=r.expr(t,o);const d=Object.values(a);return d.forEach((t=>t.fields=t.fields.map((t=>m[t])))),{names:i,exprs:u,ops:d}}function Nr(t){return t&&V(t.params)?t.params():{}}const Ar="Expr",Or="ExprList",Sr="ExprNumber",Tr="ExprObject",Cr="JoinKeys",Ir="JoinValues",Ur="Options",Fr="OrderKeys",Dr="SelectionList",Rr="TableRef",zr="TableRefList",qr="Descending",Pr="Selection",Lr="Window";function Vr(t,e){return t&&t.expr?new Br({...t,...e}):new Br(e,t)}class Br{constructor(t,e){this.expr=e,Object.assign(this,t)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...V(this.expr)?{func:!0}:{}}}}function Gr(t){return Vr(t,{desc:!0})}function Jr(t,e,n=0){const r=n?{field:!0,table:n}:{field:!0};return Vr(t,e?{expr:e,...r}:r)}function Hr(t,e,n){return Vr(t,{window:{frame:e||[-1/0,0],peers:!!n}})}function Wr(t,e){return(e=e&&V(e.query)?e.query():e)&&V(e.evaluate)?e.evaluate(null,t):t(e)}function Yr(t){return Y(t)&&(D(t.all)||D(t.matches)||D(t.not)||D(t.range))}function Qr(t){return t&&V(t.toObject)?t.toObject():V(t)?{expr:String(t),func:!0}:D(t)?t.map(Qr):Y(t)?dn(t,(t=>Qr(t))):t}function Kr(t){return D(t)?t.map(Kr):Y(t)?D(t.verbs)?go.from(t):D(t.all)?Mn():D(t.range)?En(...t.range):D(t.match)?jn(RegExp(...t.match)):D(t.not)?$n(t.not.map(Qr)):function(t){let e=t,n=t.expr;if(null!=n){if(!0===t.field?e=n=Jr(n):!0===t.func&&(e=n=function(t){const e=t=>t;return e.toString=()=>t,e}(n)),Y(t.window)){const{frame:r,peers:o}=t.window;e=n=Hr(n,r,o)}!0===t.desc&&(e=Gr(n))}return t===e?dn(t,(t=>Kr(t))):e}(t):t}function Zr(t){const e=[];return R(t).forEach((t=>{L(t)?e.push(t):K(t)?e.push(Jr(t,null)):Y(t)&&t.expr||V(t)?e.push(t):P("Invalid key value: "+(t+""))})),e}function Xr(t,e){return e<2?R(t):t}const to={[Ar]:io,[Or]:uo,[Sr]:function(t){return L(t)?t:oo(t)},[Tr]:oo,[Cr]:function(t){return D(t)?t.map(uo):oo(t,{join:!0})},[Ir]:function(t){return D(t)?t.map(((t,e)=>e<2?uo(t):oo(t,{join:!0}))):oo(t,{join:!0})},[Fr]:uo,[Dr]:function(t){return R(t).map(ao).flat()}};function eo(t,e,n){return e===Ur?t?function(t,e={}){const n={};for(const r in t){const o=t[r];n[r]=e[r]?eo(o,e[r]):o}return n}(t,n):t:to[e](t)}function no(t){return{type:oe,name:t}}function ro(t){return{type:oe,index:t}}function oo(t,e){if(K(t))return function(t,e){return kr({expr:t},{...e,ast:!0}).exprs[0]}(t,e);if(t.expr){let n;if(!0===t.field?n=no(t.expr):!0===t.func&&(n=oo(t.expr,e)),n)return t.desc&&(n={type:qr,expr:n}),t.window&&(n={type:Lr,expr:n,...t.window}),n}return Object.keys(t).map((n=>({...oo(t[n],e),as:n})))}function so(t){const e=Pr;return t.all?{type:e,operator:"all"}:t.not?{type:e,operator:"not",arguments:uo(t.not)}:t.range?{type:e,operator:"range",arguments:uo(t.range)}:t.matches?{type:e,operator:"matches",arguments:t.matches}:P("Invalid input")}function ao(t){return Yr(t)?so(t):L(t)?ro(t):K(t)?no(t):Y(t)?Object.keys(t).map((e=>({type:oe,name:e,as:t[e]}))):P("Invalid input")}function io(t){return Yr(t)?so(t):L(t)?ro(t):K(t)?no(t):Y(t)?oo(t):P("Invalid input")}function uo(t){return R(t).map(io).flat()}function co(t){return t&&V(t.toAST)?t.toAST():t}class lo{constructor(t,e=[],n=[]){this.verb=t,this.schema=e,e.forEach(((t,e)=>{const r=t.type,o=n[e],s=r===Cr?D(a=o)?a.map(Zr):a:r===Ir?function(t){return D(t)?t.map(Xr):t}(o):r===Fr?function(t){const e=[];return t.forEach((t=>{const n=null!=t.expr?t.expr:t;if(Y(n)&&!V(n))for(const t in n)e.push(n[t]);else t=L(n)?n:K(n)?Jr(t):V(n)?t:P("Invalid orderby field: "+t),e.push(t)})),e}(o):o;var a;this[t.name]=void 0!==s?s:t.default}))}static from(t){const e=po[t.verb],n=(e.schema||[]).map((({name:e})=>Kr(t[e])));return e(...n)}evaluate(t,e){const n=this.schema.map((({name:t,type:n})=>{const r=this[t];return n===Rr?Wr(e,r):n===zr?r.map((t=>Wr(e,t))):r}));return t[this.verb](...n)}toObject(){const t={verb:this.verb};return this.schema.forEach((({name:e})=>{t[e]=Qr(this[e])})),t}toAST(){const t={type:"Verb",verb:this.verb};return this.schema.forEach((({name:e,type:n,props:r})=>{t[e]=function(t,e,n){return e===Rr?co(t):e===zr?t.map(co):eo(Qr(t),e,n)}(this[e],n,r)})),t}}function fo(t,e){return Object.assign(((...n)=>new lo(t,e,n)),{schema:e})}const po={count:fo("count",[{name:"options",type:Ur}]),derive:fo("derive",[{name:"values",type:Tr},{name:"options",type:Ur,props:{before:Dr,after:Dr}}]),filter:fo("filter",[{name:"criteria",type:Tr}]),groupby:fo("groupby",[{name:"keys",type:Or}]),orderby:fo("orderby",[{name:"keys",type:Fr}]),relocate:fo("relocate",[{name:"columns",type:Dr},{name:"options",type:Ur,props:{before:Dr,after:Dr}}]),rename:fo("rename",[{name:"columns",type:Dr}]),rollup:fo("rollup",[{name:"values",type:Tr}]),sample:fo("sample",[{name:"size",type:Sr},{name:"options",type:Ur,props:{weight:Ar}}]),select:fo("select",[{name:"columns",type:Dr}]),ungroup:fo("ungroup"),unorder:fo("unorder"),reify:fo("reify"),dedupe:fo("dedupe",[{name:"keys",type:Or,default:[]}]),impute:fo("impute",[{name:"values",type:Tr},{name:"options",type:Ur,props:{expand:Or}}]),fold:fo("fold",[{name:"values",type:Or},{name:"options",type:Ur}]),pivot:fo("pivot",[{name:"keys",type:Or},{name:"values",type:Or},{name:"options",type:Ur}]),spread:fo("spread",[{name:"values",type:Or},{name:"options",type:Ur}]),unroll:fo("unroll",[{name:"values",type:Or},{name:"options",type:Ur,props:{drop:Or}}]),lookup:fo("lookup",[{name:"table",type:Rr},{name:"on",type:Cr},{name:"values",type:Or}]),join:fo("join",[{name:"table",type:Rr},{name:"on",type:Cr},{name:"values",type:Ir},{name:"options",type:Ur}]),cross:fo("cross",[{name:"table",type:Rr},{name:"values",type:Ir},{name:"options",type:Ur}]),semijoin:fo("semijoin",[{name:"table",type:Rr},{name:"on",type:Cr}]),antijoin:fo("antijoin",[{name:"table",type:Rr},{name:"on",type:Cr}]),concat:fo("concat",[{name:"tables",type:zr}]),union:fo("union",[{name:"tables",type:zr}]),intersect:fo("intersect",[{name:"tables",type:zr}]),except:fo("except",[{name:"tables",type:zr}])};function mo(t){return new go(null,null,t)}function ho(t){return go.from(t)}class go extends q{constructor(t,e,n){super(e),this._verbs=t||[],this._table=n}static from({verbs:t,table:e,params:n}){return new go(t.map(lo.from),n,e)}get[Symbol.toStringTag](){if(!this._verbs)return"Object";return`Query: ${this._verbs.length} verbs`+(this._table?` on '${this._table}'`:"")}get length(){return this._verbs.length}get tableName(){return this._table}params(t){return arguments.length?(this._params={...this._params,...t},this):this._params}evaluate(t,e){t=t||e(this._table);for(const n of this._verbs)t=n.evaluate(t.params(this._params),e);return t}toObject(){return yo(this,"toObject")}toJSON(){return this.toObject()}toAST(){return yo(this,"toAST",{type:"Query"})}}function yo(t,e,n){return{...n,verbs:t._verbs.map((t=>t[e]())),...t._params?{params:t._params}:null,...t._table?{table:t._table}:null}}function _o(t,e){return new go(t._verbs.concat(e),t._params,t._table)}for(const t in po){const e=po[t];go.prototype["__"+t]=function(t,...n){return _o(t,e(...n))}}var vo="5.4.0";function bo(t){const{data:e,length:n,nullCount:r}=t,o=e[e.length-1].dictionary,s=o.length,a=function(t,e,n,r){const o=t.length>1||n?function(t,e,n){const r=new n.ArrayType(e),o=t.length;for(let e,n=0,s=0;n<o;++n)e=t[n].length,r.set(t[n].values.subarray(0,e),s),s+=e;return r}(t,e,t[0].type.indices):t[0].values;return n?function(t,e,n){const r=t.length;for(let o,s,a,i,u=0,c=0;u<r;++u){if(a=t[u].nullBitmap,o=t[u].length>>3,a&&a.length)for(let t=0;t<=o;++t)255!==(i=a[t])&&(s=c+(t<<3),0==(1&i)&&(e[s+0]=n),0==(2&i)&&(e[s+1]=n),0==(4&i)&&(e[s+2]=n),0==(8&i)&&(e[s+3]=n),0==(16&i)&&(e[s+4]=n),0==(32&i)&&(e[s+5]=n),0==(64&i)&&(e[s+6]=n),0==(128&i)&&(e[s+7]=n));c+=t[u].length}return e}(t,o,r):o}(e||[t],n,r,s),i=Array(s),u=t=>null==t||t<0||t>=s?null:void 0!==i[t]?i[t]:i[t]=o.get(t);return{vector:t,length:n,get:t=>u(a[t]),key:t=>a[t],keyFor(t){if(null===t)return r?s:-1;for(let e=0;e<s;++e)if(void 0===i[e]&&(i[e]=o.get(e)),i[e]===t)return e;return-1},groups(t){const e=s+(r?1:0);return{keys:a,get:[u],names:t,rows:Ut(0,e),size:e}},[Symbol.iterator]:()=>t[Symbol.iterator]()}}function wo(t,e,...n){const r=["_","$"],o=r.slice(0,n.length);return o.push('"use strict"; const '+n.map(((t,e)=>t.map(((t,n)=>`${r[e]}${n} = ${r[e]}[${n}]`)).join(", "))).join(", ")+`; return (${t}) => ${e};`),Function(...o)(...n)}const xo=({typeId:t})=>-1===t,Mo=({typeId:t})=>5===t;function $o(t,e){const{type:n,length:r,numChildren:o}=t;if(xo(n))return bo(t);const s=o&&e?ko(t):o?Eo(ko(t)):Mo(n)?Eo((e=>t.get(e))):null;return s?{vector:t,length:r,get:s,[Symbol.iterator]:()=>function*(t,e){for(let n=0;n<t;++n)yield e(n)}(r,s)}:t}function Eo(t){const e=[];return n=>{const r=e[n];return void 0!==r?r:e[n]=t(n)}}const jo=t=>t.numChildren?B(t.length,ko(t)):t.nullCount?[...t]:t.toArray(),ko=t=>{return(({typeId:t})=>12===t)(e=t.type)||(({typeId:t})=>16===t)(e)?No(t):(({typeId:t})=>13===t)(t.type)?function(t){const e=[],n=[];t.type.children.forEach(((r,o)=>{e.push($o(t.getChildAt(o),!0)),n.push(`${Rt(r.name)}:_${o}.get(row)`)}));const r=wo("row","({"+n+"})",e);return t.nullCount?e=>t.isValid(e)?r(e):null:r}(t):P(`Unsupported Arrow type: ${Rt(t.VectorName)}`);var e},No=t=>t.nullCount?e=>t.isValid(e)?jo(t.get(e)):null:e=>jo(t.get(e));function Ao(t,e={}){t&&!t.batches&&(t=function(){try{return I}catch(t){un()}}()(t));const n=t.schema.fields.map((t=>t.name)),r=bn({columnNames:t=>t?n.filter(t):n.slice(),columnIndex:t=>n.indexOf(t)},e.columns||Mn()),o=nt();return r.forEach(((e,n)=>{o.add(e,$o(t.getChild(n)))})),new An(o.data,o.names)}var Oo=t=>t;const So=[t=>"true"===t||"false"===t,t=>"false"!==t],To=[t=>"NaN"===t||(t=+t)===t,t=>+t],Co=[_t,t=>new Date(Date.parse(t))];function Io(t){const{decimal:e}=t;return e&&"."!==e?To.map((t=>n=>t(n&&n.replace(e,".")))):To}function Uo(t,e){const n=t.length;for(let r=0;r<n;++r){const n=t[r];if(null!=n&&!e(n))return!1}return!0}function Fo(t,e=0){return B(t-e,(t=>`col${t+e+1}`))}function Do(t,e,n){let r=t();const o=r.length,s=+n.autoMax||1e3,a=B(o,(()=>[]));e=e?e.length<o?[...e,Fo(o,e.length)]:e:Fo(o);let i=0;for(;i<s&&r;++i,r=t())for(let t=0;t<o;++t)a[t].push(""===r[t]?null:r[t]);const u=function(t,e,n){const{parse:r={}}=n,o=!1===n.autoType;return t.map(((t,s)=>V(r[t])?r[t]:o?Oo:function(t,e){const n=[So,Io(e),Co],r=n.length;for(let e=0;e<r;++e){const[r,o]=n[e];if(Uo(t,r))return o}return Oo}(e[s],n)))}(e,a,n);for(u.forEach(((t,e)=>{if(t===Oo)return;const n=a[e];for(let e=0;e<i;++e)null!=n[e]&&(n[e]=t(n[e]))}));r;r=t())for(let t=0;t<o;++t)a[t].push(r[t]?u[t](r[t]):null);const c={};return e.forEach(((t,e)=>c[t]=a[e])),new An(c,e)}const Ro={},zo={},qo=34,Po=10,Lo=13;function Vo(t,e,n){let r=+e||0;for(;--r>=0;)t();return n?()=>{let e;for(;!e;){if(!n(e=t()))return e;e=null}}:t}function Bo(t,e={}){const n=function(t,{delimiter:e=",",skip:n,comment:r}){1!==e.length&&P(`Text "delimiter" should be a single character, found "${e}"`);const o=e.charCodeAt(0);let s,a=t.length,i=0,u=a<=0,c=!1;function l(){if(u)return zo;if(c)return c=!1,Ro;const e=i;let n,r;if(t.charCodeAt(e)===qo){for(;i++<a&&t.charCodeAt(i)!==qo||t.charCodeAt(++i)===qo;);return(n=i)>=a?u=!0:(r=t.charCodeAt(i++))===Po?c=!0:r===Lo&&(c=!0,t.charCodeAt(i)===Po&&++i),t.slice(e+1,n-1).replace(/""/g,'"')}for(;i<a;){if((r=t.charCodeAt(n=i++))===Po)c=!0;else if(r===Lo)c=!0,t.charCodeAt(i)===Po&&++i;else if(r!==o)continue;return t.slice(e,n)}return u=!0,t.slice(e,a)}return t.charCodeAt(a-1)===Po&&--a,t.charCodeAt(a-1)===Lo&&--a,Vo((function(){if((s=l())!==zo){const t=[];for(;s!==Ro&&s!==zo;)t.push(s),s=l();return t}}),n,r&&(t=>(t&&t[0]||"").startsWith(r)))}(t,e);return Do(n,!1!==e.header?n():e.names,e)}function Go(t,e={}){const n=function(t,{skip:e,comment:n}){let r=t.length,o=0;return t.charCodeAt(r-1)===Po&&--r,t.charCodeAt(r-1)===Lo&&--r,Vo((function(){if(o>=r)return;const e=o;let n,s,a=!1;for(;o<r;)if((s=t.charCodeAt(n=o++))===Po?a=!0:s===Lo&&(a=!0,t.charCodeAt(o)===Po&&++o),a)return t.slice(e,n);return t.slice(e,r)}),e,n&&(t=>(t||"").startsWith(n)))}(t,e),r=function({positions:t,widths:e}){t||e||P('Fixed width files require a "positions" or "widths" option');let n=0;return t||e.map((t=>[n,n+=t]))}(e);return Do((()=>{const t=n();if(t)return r.map((([e,n])=>t.slice(e,n).trim()))}),e.names,e)}function Jo(t){const e=t.length;for(let n=0;n<e;++n){const e=t.charCodeAt(n);if(e<48||e>57)return!1}return!0}function Ho(t,e={}){const n=gn(e.autoType);K(t)&&(t=JSON.parse(t));let r,o=t.data;if(Y(o)&&!it(o)?t.schema&&t.schema.fields&&(r=t.schema.fields.map((t=>t.name))):o=t,n||e.parse){const t=e.parse||{};for(const e in o){const r=o[e],s=r.length;if(t[e])for(let n=0;n<s;++n)r[n]=t[e](r[n]);else if(n)for(let t=0;t<s;++t){const e=r[t];K(e)&&_t(e)&&!Jo(e)&&(r[t]=new Date(e))}}}return new An(o,r)}function Wo(t,e){const n=nt();return e.forEach(((e,r)=>{const o=K(e)?e:r;if(o){const e=t.column(r)||P(`Unrecognized column: ${r}`);n.add(o,e)}})),t.create(n)}function Yo(t,e,{before:n,after:r}={}){const o=null!=n,s=null!=r;o||s||P("relocate requires a before or after option."),o&&s&&P("relocate accepts only one of the before or after options."),e=bn(t,e);const a=[...bn(t,o?n:r).keys()],i=o?a[0]:a.pop(),u=new Map;return t.columnNames().forEach((t=>{const n=!e.has(t);if(t===i){s&&n&&u.set(t,t);for(const[t,n]of e)u.set(t,n);if(s)return}n&&u.set(t,t)})),Wo(t,u)}function Qo(t,e=(t=>t),n=""){const r=t.length;if(!r)return"";let o=e(t[0],0);for(let s=1;s<r;++s)o+=n+e(t[s],s);return o}function Ko(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Zo(t){return Dt(t)?t:+t}class Xo{constructor(t){this._values=t||[],this._sorted=null,this._start=0}values(t){return this._start&&(this._values=this._values.slice(this._start),this._start=0),t?this._values.slice():this._values}add(t){this._values.push(t),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:function(t,e=0,n=t.length){let r=n?t[e++]:ot;for(let o=e;o<n;++o)r>t[o]&&(r=t[o]);return r}(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:function(t,e=0,n=t.length){let r=n?t[e++]:ot;for(let o=e;o<n;++o)r<t[o]&&(r=t[o]);return r}(this._values,this._start)}quantile(t){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(Ko)),function(t,e){const n=t.length;if(!n)return ot;if((e=+e)<=0||n<2)return Zo(t[0]);if(e>=1)return Zo(t[n-1]);const r=(n-1)*e,o=Math.floor(r),s=Zo(t[o]);return Dt(s)?s:s+(Zo(t[o+1])-s)*(r-o)}(this._sorted,t)}}const ts=(t,e,n)=>wo(e,"{"+Qo(t,((t,r)=>`_${r}.${n}(${e});`))+"}",t);function es(t,e){const{ops:n,output:r}=function(t,e){const n={},r=[];function o(t,s=[]){const a=t+":"+s;if(n[a])return n[a];const i=Ae(t),u=i.create(...s);return e<0&&i.stream&&i.stream.forEach((t=>o(t,[]))),i.req&&i.req.forEach((t=>o(t,[]))),n[a]=u,r.push(u),u}const s=t.map((t=>{const e=o(t.name,t.params);return e.output=t.id,e}));return{ops:r,output:s}}(t,e),o=t[0].fields,s=o.length;return new(0===s?ns:1===s?rs:2===s?os:P("Unsupported field count: "+s))(o,n,r,e)}class ns extends Sn{constructor(t,e,n,r){super(n),this._op=e,this._fields=t,this._stream=!!r}init(){const t={count:0,valid:0,stream:this._stream};return this._op.forEach((e=>e.init(t))),t.values&&(t.list=new Xo),t}write(t,e,n){const r=this._outputs,o=r.length;for(let s=0;s<o;++s)e[r[s].output][n]=r[s].value(t);return 1}_add(){}_rem(){}add(t){++t.count}rem(t){--t.count}}class rs extends ns{constructor(t,e,n,r){super(t,e,n,r);const o=["state","v1","v2"];this._add=ts(e,o,"add"),this._rem=ts(e,o,"rem")}add(t,e,n){const r=this._fields[0](e,n);++t.count,ut(r)&&(++t.valid,t.list&&t.list.add(r),this._add(t,r))}rem(t,e,n){const r=this._fields[0](e,n);--t.count,ut(r)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r))}}class os extends ns{constructor(t,e,n,r){super(t,e,n,r);const o=["state","v1","v2"];this._add=ts(e,o,"add"),this._rem=ts(e,o,"rem")}add(t,e,n){const r=this._fields[0](e,n),o=this._fields[1](e,n);++t.count,ut(r)&&ut(o)&&(++t.valid,t.list&&t.list.add([r,o]),this._add(t,r,o))}rem(t,e,n){const r=this._fields[0](e,n),o=this._fields[1](e,n);--t.count,ut(r)&&ut(o)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r,o))}}function ss(t,e,n){if(e.length){const r=t.data(),{keys:o}=t.groups()||{},s=as(t,e),a=o?(t,e)=>s[t][o[e]]:t=>s[t][0];n=n.map((t=>e=>t(e,r,a)))}return n}function as(t,e,n){if(!e.length)return n;const r=is(e),o=t.groups(),s=o?o.size:1;return n=n||B(e.length,(()=>Array(s))),s>1?r.forEach((e=>{const r=cs(t,e,o);for(let t=0;t<s;++t)e.write(r[t],n,t)})):r.forEach((e=>{const r=us(t,e);e.write(r,n,0)})),n}function is(t,e){const n=[],r={};for(const e of t){const t=e.fields.map((t=>t+"")).join(",");(r[t]||(r[t]=[])).push(e)}for(const t in r)n.push(es(r[t],e));return n}function us(t,e){const n=e.init(),r=t.totalRows(),o=t.data(),s=t.mask();if(t.isOrdered()){const s=t.indices();for(let t=0;t<r;++t)e.add(n,s[t],o)}else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))e.add(n,t,o);else for(let t=0;t<r;++t)e.add(n,t,o);return n}function cs(t,e,n){const{keys:r,size:o}=n,s=B(o,(()=>e.init())),a=t.data();if(t.isOrdered()){const n=t.indices(),o=n.length;for(let t=0;t<o;++t){const o=n[t];e.add(s[r[o]],o,a)}}else if(t.isFiltered()){const n=t.mask();for(let t=n.next(0);t>=0;t=n.next(t+1))e.add(s[r[t]],t,a)}else{const n=t.totalRows();for(let t=0;t<n;++t)e.add(s[r[t]],t,a)}return s}function ls(t,e){const{get:n,names:r,rows:o,size:s}=e,a=r.length;for(let e=0;e<a;++e){const a=t.add(r[e],Array(s)),i=n[e];for(let t=0;t<s;++t)a[t]=i(o[t])}}function fs(t){return{left(e,n,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const s=r+o>>>1;t(e[s],n)<0?r=s+1:o=s}return r},right(e,n,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const s=r+o>>>1;t(e[s],n)>0?o=s:r=s+1}return r}}}const ps=fs(Ko);const ms=t=>(t.frame||[null,null]).map((t=>Number.isFinite(t)?Math.abs(t):null)),ds=t=>!!t.peers;function hs(t,e,n,r={},o){const s=t.data(),a=function(t,e){const n={};return t.forEach((t=>{const e=ms(t),r=ds(t),o=`${e},${r}`,{aggOps:s,winOps:a}=n[o]||(n[o]={frame:e,peers:r,aggOps:[],winOps:[]});je(t.name)?s.push(t):a.push(function(t){const{id:e,name:n,fields:r=[],params:o=[]}=t,s=Oe(n).create(...o);return r.length&&(s.get=r[0]),s.id=e,s}(t))})),Object.values(n).map((t=>function(t,e,n,r,o){let s,a,i,u,c;const l=t=>a[t-1]===a[t],f=r.length,p=o.length,m=r.length?wo(["w","r","k"],"{"+Qo(r,((t,e)=>`r[_${e}.id][k]=_${e}.value(w,_${e}.get);`))+"}",r):()=>{},d={i0:0,i1:0,index:0,size:0,peer:l,init(t,e,n,l){d.index=d.i0=d.i1=0,d.size=e.length,s=t,a=e,u=n,c=l,i=o?o.map((t=>t.init())):null;for(let t=0;t<f;++t)r[t].init();return d},value:(e,n)=>n(s[e],t),step(r){const[f,h]=e,g=d.size,y=d.i0,_=d.i1;d.i0=null!=f?Math.max(0,r-Math.abs(f)):0,d.i1=null!=h?Math.min(g,r+Math.abs(h)+1):g,d.index=r,n&&(d.i0>0&&l(d.i0)&&(d.i0=ps.left(a,a[d.i0])),d.i1<g&&l(d.i1)&&(d.i1=ps.right(a,a[d.i1-1])));for(let e=0;e<p;++e){const n=o[e],r=i[e];for(let e=y;e<d.i0;++e)n.rem(r,s[e],t);for(let e=_;e<d.i1;++e)n.add(r,s[e],t);n.write(r,u,c)}return m(d,u,c),u}};return d}(e,t.frame,t.peers,t.winOps,is(t.aggOps,null!=t.frame[0]?-1:1))))}(o,s),i=a.length,u=wo(["r","d","op"],"{"+Qo(e,((t,e)=>`_${e}[r] = $${e}(r, d, op);`))+"}",e,n);t.partitions().forEach(((e,n)=>{const o=e.length,c=function(t,e){if(t.isOrdered()){const n=t.comparator(),r=t.data(),o=e.length,s=new Uint32Array(o);for(let t=1,a=0;t<o;++t)s[t]=n(e[t-1],e[t],r)?++a:a;return s}return e}(t,e);for(let t=0;t<i;++t)a[t].init(e,c,r,n);const l=t=>r[t][n];for(let t=0;t<o;++t){for(let e=0;e<i;++e)a[e].step(t);u(e[t],s,l)}}))}function gs(t){return ke(t.name)||t.frame&&(Number.isFinite(t.frame[0])||Number.isFinite(t.frame[1]))}function ys(t,{names:e,exprs:n,ops:r},o={}){const s=t.totalRows(),a=nt(o.drop?null:t),i=e.map((t=>a.add(t,Array(s)))),[u,c]=function(t){const e=[],n=[],r=t.length;for(let o=0;o<r;++o){const r=t[o];r.id=o,(gs(r)?n:e).push(r)}return[e,n]}(r),l=t.isGrouped()?t.groups().size:1,f=as(t,u,B(r.length,(()=>Array(l))));return c.length?hs(t,i,n,f,c):function(t,e,n,r){const o=t.mask(),s=t.data(),{keys:a}=t.groups()||{},i=a?(t,e)=>r[t][a[e]]:t=>r[t][0],u=e.length;for(let r=0;r<u;++r){const a=n[r],u=e[r];if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))u[t]=a(t,s,i);else{const e=t.totalRows();for(let t=0;t<e;++t)u[t]=a(t,s,i)}}}(t,i,n,f),t.create(a)}const _s=2147483648;class vs{constructor(t){this._size=t,this._bits=new Uint32Array(Math.ceil(t/32))}get length(){return this._size}count(){const t=this._bits.length;let e=0;for(let n=0;n<t;++n)for(let t=this._bits[n];t;++e)t&=t-1;return e}get(t){return this._bits[t>>5]&_s>>>t}set(t){this._bits[t>>5]|=_s>>>t}clear(t){this._bits[t>>5]&=~(_s>>>t)}scan(t){for(let e=this.next(0);e>=0;e=this.next(e+1))t(e)}next(t){const e=this._bits,n=e.length;let r=t>>5,o=e[r]&4294967295>>>t;for(;r<n;o=e[++r])if(0!==o)return(r<<5)+Math.clz32(o);return-1}nth(t){let e=this.next(0);for(;t--&&e>=0;)e=this.next(e+1);return e}not(){const t=this._bits,e=t.length;for(let n=0;n<e;++n)t[n]=~t[n];const n=this._size%32;return n&&(t[e-1]&=_s>>n-1),this}and(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]&=n[t]}return this}or(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]|=n[t]}return this}}function bs(t,{names:e=[],exprs:n=[],ops:r=[]},o={}){if(!e.length)return t;const s=o.limit>0?+o.limit:1/0,a=o.index?!0===o.index?"index":o.index+"":null,i=new Set(o.drop),u=ss(t,r,n),c=nt(),l=new Set(e),f=[],p=[],m=[];t.columnNames().forEach((e=>{if(!i.has(e)){const n=c.add(e,[]);l.has(e)||(f.push(t.column(e)),p.push(n))}})),e.forEach((t=>{i.has(t)||(c.has(t)||c.add(t,[]),m.push(c.data[t]))}));const d=a?c.add(a,[]):null;let h=0;const g=f.length,y=m.length,_=(t,e)=>{for(let n=0;n<g;++n)p[n].length=h+e,p[n].fill(f[n].get(t),h,h+e)},v=d?(t,e)=>{for(let n=0;n<e;++n)d[t+n]=n}:()=>{};if(1===y){const e=u[0],n=m[0];t.scan(((t,r)=>{const o=R(e(t,r)),a=Math.min(o.length,s);_(t,a);for(let t=0;t<a;++t)n[h+t]=o[t];v(h,a),h+=a}))}else t.scan(((t,e)=>{let n=0;const r=u.map((r=>{const o=R(r(t,e));return n=Math.min(Math.max(n,o.length),s),o}));_(t,n);for(let t=0;t<y;++t){const e=m[t],o=r[t];for(let t=0;t<n;++t)e[h+t]=o[t]}v(h,n),h+=n}));return t.create(c.new())}function ws(t,e,n,r={window:!1}){const o=new Map,s=n=>{K(n=L(n)?e.columnName(n):n)?o.set(n,Jr(n)):V(n)?bn(e,n).forEach(s):Y(n)?_n(o,n):P(`Invalid ${t} value: ${n+""}`)};return R(n).forEach(s),r.preparse&&r.preparse(o),kr(o,{table:e,...r})}function xs(t,e,n,r){const o=n&&n.length;return function(t,{names:e,exprs:n,ops:r},o){const s=ss(t,r,n),a=o?null:nt(t),i=t.totalRows();return e.forEach(((e,n)=>{const r=t.column(e),u=o?r.data:a.add(e,Array(i)),c=s[n];t.scan((t=>{const e=r.get(t);u[t]=ut(e)?e:c(t)}))})),o?t:t.create(a)}(o?function(t,e,n){const r=t.groups(),o=t.data(),s=(r?r.names:[]).concat(e),a=(r?r.get:[]).concat(e.map((e=>t.getter(e)))),i=new Set,u=_e(a);t.scan(((t,e)=>i.add(u(t,e))));const c=t.columnNames(),l=nt(),f=c.map((t=>l.add(t,[])));c.forEach(((e,n)=>{const r=o[e],s=f[n];t.scan((t=>s.push(r.get(t))))}));const p=_e(a.map(((t,e)=>t=>t[e]))),m=wo("v","{"+f.map(((t,e)=>`_${e}.push(v[$${e}]);`)).join("")+"}",f,c.map((t=>s.indexOf(t))));if(r){let t=r.keys.length;const e=n.reduce(((t,e)=>t*e.length),r.size),o=new Uint32Array(e+(t-i.size));o.set(r.keys),Ms(r,n,((e,n)=>{i.has(p(e))||(m(e),o[t++]=n[0])})),l.groupby({...r,keys:o})}else Ms(r,n,(t=>{i.has(p(t))||m(t)}));return t.create(l.new())}(t,n,r):t,e,o)}function Ms(t,e,n){const r=t?t.get.length:0,o=t?1:0,s=o+e.length,a=new Int32Array(s),i=new Int32Array(s),u=[];if(t){const{get:e,rows:n,size:o}=t;a[0]=o,u.push(((t,o)=>{const s=n[o];for(let n=0;n<r;++n)t[n]=e[n](s)}))}e.forEach(((t,e)=>{const n=e+r;a[e+o]=t.length,u.push(((e,r)=>e[n]=t[r]))}));const c=Array(r+e.length);for(let t=0;t<s;++t)u[t](c,0);n(c,i);for(let t=s-1;t>=0;){const e=++i[t];e<a[t]?(u[t](c,e),n(c,i),t=s-1):(i[t]=0,u[t](c,0),--t)}}function $s(t,{names:e,exprs:n,ops:r}){const o=nt(),s=t.groups();return s&&ls(o,s),function(t,e,n,r=[],o){if(!e.length)return;const s=n?n.size:1,a=(t,e)=>r[t][e],i=t.length;for(let n=0;n<i;++n){const i=e[n];if(null!=i.field)o.add(t[n],r[i.field]);else if(s>1){const e=o.add(t[n],Array(s));for(let t=0;t<s;++t)e[t]=i(t,null,a)}else o.add(t[n],[i(0,null,a)])}}(e,n,s,as(t,r),o),t.create(o.new())}function Es(t){t.forEach(((e,n)=>e.field?t.set(n,Bt(e+"")):0))}function js(t,e){const n=new Map;return t.scan(((t,r)=>{const o=e(t,r);null!=o&&o==o&&n.set(o,t)})),n}function ks(t,e,n,{names:r,exprs:o},s={}){const a=t.data(),i=t.indices(!1),u=i.length,c=new Int32Array(u),l=e.data(),f=e.indices(!1),p=f.length,m=new Int32Array(p),d=r.length,h=nt(),g=Array(d),y=Array(d);for(let t=0;t<r.length;++t)g[t]=h.add(r[t],[]),y[t]=o[t];const _=function(t,e){const n=["i","a","j","b"];return wo(n,"{"+Qo(t,((t,e)=>`_${e}.push($${e}(${n}));`))+"}",t,e)}(g,y);if((D(n)?As:Ns)(_,n,a,l,i,f,c,m,u,p),s.left)for(let t=0;t<u;++t)c[t]||_(i[t],a,-1,l);if(s.right)for(let t=0;t<p;++t)m[t]||_(-1,a,f[t],l);return t.create(h.new())}function Ns(t,e,n,r,o,s,a,i,u,c){for(let l=0;l<u;++l){const u=o[l];for(let o=0;o<c;++o){const c=s[o];e(u,n,c,r)&&(t(u,n,c,r),a[l]=1,i[o]=1)}}}function As(t,[e,n],r,o,s,a,i,u,c,l){let f,p,m,d,h,g,y,_,v=t;c>=l?(f=r,p=e,m=i,d=s,h=o,g=n,y=u,_=a):(f=o,p=n,m=u,d=a,h=r,g=e,y=i,_=s,v=(e,n,r,o)=>t(r,o,e,n));const b=function(t,e,n){const r=new Map,o=t.length;for(let s=0;s<o;++s){const o=n(t[s],e);null!=o&&o==o&&(r.has(o)?r.get(o).push(s):r.set(o,[s]))}return r}(_,h,g),w=d.length;for(let t=0;t<w;++t){const e=d[t],n=b.get(p(e,f));if(n){const r=n.length;for(let t=0;t<r;++t){const r=n[t];v(e,f,_[r],h),y[r]=1}m[t]=1}}}function Os(t,e,n){const r=new Map;R(n).forEach(((n,o)=>{K(n=L(n)?e.columnName(n):n)?r.set(o,Jr(n)):V(n)||Y(n)&&n.expr?r.set(o,n):P(`Invalid ${t} key value: ${n+""}`)}));return _e(kr(r,{table:e,aggregate:!1,window:!1}).exprs,!0)}function Ss(t,e,n){if(n)K(n)?n=[n,n]:D(n)&&1===n.length&&(n=[n[0],n[0]]);else{const r=function(t,e){const n=new Set(e);return t.filter((t=>n.has(t)))}(t.columnNames(),e.columnNames());r.length||P("Natural join requires shared column names."),n=[r,r]}return n}function Ts(t,e,n,r){return n.length!==r.length&&P("Mismatched number of join keys"),[Os("join",t,n),Os("join",e,r)]}const Cs={aggregate:!1,window:!1,index:1};function Is(t,e,n,r,o={}){n=Ss(t,e,n);const s={join:[t,e]};let a;if(D(n)){const[s,i]=n.map(R);a=Ts(t,e,s,i),r||(r=function(t,e,n,r){const o=[];e.forEach(((t,e)=>K(t)&&t===n[e]?o.push(t):0));const s=$n(o);if(r.left&&r.right){const e=new Set(o);return[t.columnNames().map((t=>{const n=`[${Rt(t)}]`;return e.has(t)?{[t]:`(a, b) => a${n} == null ? b${n} : a${n}`}:t})),s]}return r.right?[s,Mn()]:[Mn(),s]}(t,s,i,o))}else a=kr({on:n},s).exprs[0],r||(r=[Mn(),Mn()]);return ks(t,e,a,function(t,e,n,r,o=[]){if(D(n)){let s,a,i,u=n.length;s=a=i={names:[],exprs:[]},u--&&(s=ws("join",t,n[0],r)),u--&&(a=ws("join",e,n[1],Cs)),u--&&(i=kr(n[2],r));const c=new Set,l=new Set(s.names);return a.names.forEach((t=>{l.has(t)&&c.add(t)})),c.size&&(""!==o[0]&&Us(s.names,c,o[0]||"_1"),""!==o[1]&&Us(a.names,c,o[1]||"_2")),{names:s.names.concat(a.names,i.names),exprs:s.exprs.concat(a.exprs,i.exprs)}}return kr(n,r)}(t,e,r,s,o&&o.suffix),o)}function Us(t,e,n){t.forEach(((r,o)=>e.has(r)?t[o]=r+n:0))}function Fs(t,e,n,[r,o]){const s=js(n,o);e.scan(((e,n)=>{s.get(r(e,n))>=0&&t.set(e)}))}function Ds(t,e,n,r){const o=e.numRows(),s=n.numRows(),a=e.data(),i=n.data();if(e.isFiltered()||n.isFiltered()){const u=e.indices(!1),c=n.indices(!1);for(let e=0;e<o;++e){const n=u[e];for(let e=0;e<s;++e)if(r(n,a,c[e],i)){t.set(n);break}}}else for(let e=0;e<o;++e)for(let n=0;n<s;++n)if(r(e,a,n,i)){t.set(e);break}}function Rs(t,e,n,r){n=Ss(t,e,n);return function(t,e,n,r={}){const o=new vs(t.totalRows());return(D(n)?Fs:Ds)(o,t,e,n),r.anti&&o.not().and(t.mask()),t.create({filter:o})}(t,e,D(n)?Ts(t,e,...n.map(R)):kr({on:n},{join:[t,e]}).exprs[0],r)}const zs=(t,e)=>null!=t?t:e;function qs(t,e,n,r={}){const{keys:o,keyColumn:s}=function(t,e,n){const r=n.limit>0?+n.limit:1/0,o=zs(n.sort,!0),s=zs(n.keySeparator,"_"),a=ss(t,e.ops,e.exprs),i=1===a.length?a[0]:(t,e)=>a.map((n=>n(t,e))).join(s),u=Array(t.totalRows());t.scan(((t,e)=>u[t]=i(t,e)));const c=as(t.ungroup(),[{id:0,name:"array_agg_distinct",fields:[t=>u[t]],params:[]}])[0][0],l=o?c.sort():c;return{keys:Number.isFinite(r)?l.slice(0,r):l,keyColumn:u}}(t,e,r),a=zs(r.valueSeparator,"_"),i=n.names.length>1?(t,e)=>e+a+o[t]:t=>o[t],u=o.map((e=>as(t,n.ops.map((t=>{if("count"===t.name){const n=t=>e===s[t]?1:NaN;return n.toString=()=>e+":1",{...t,name:"sum",fields:[n]}}const n=t.fields.map((t=>{const n=(n,r)=>e===s[n]?t(n,r):NaN;return n.toString=()=>e+":"+t,n}));return{...t,fields:n}})))));return t.create(function({names:t,exprs:e},n,r,o){const s=r?r.size:1,a=nt(),i=o.length,u=t.length;let c;const l=(t,e)=>c[t][e];r&&ls(a,r);for(let r=0;r<u;++r){const u=e[r];if(null!=u.field)for(let e=0;e<i;++e)a.add(n(e,t[r]),o[e][u.field]);else if(s>1)for(let e=0;e<i;++e){c=o[e];const i=a.add(n(e,t[r]),Array(s));for(let t=0;t<s;++t)i[t]=u(t,null,l)}else for(let e=0;e<i;++e)c=o[e],a.add(n(e,t[r]),[u(0,null,l)])}return a.new()}(n,i,t.groups(),u))}function Ps(t){t.forEach(((e,n)=>e.field?t.set(n,Pt(e+"")):0))}function Ls(t,e){return $s(t,kr(e,{table:t,aggronly:!0,window:!1}))}function Vs(t,e,n,r){return(e?r?Gs:Bs:r?Hs:Js)(t.length,t,n,r)}function Bs(t,e,n){const r=n.length;for(let o=0;o<t;++o)e[o]=n[r*At()|0];return e}function Gs(t,e,n,r){const o=n.length,s=new Float64Array(o);let a=0;for(let t=0;t<o;++t)s[t]=a+=r(n[t]);const i=fs(Ko).right;for(let r=0;r<t;++r)e[r]=n[i(s,a*At())];return e}function Js(t,e,n){const r=n.length;if(t>=r)return n;for(let r=0;r<t;++r)e[r]=n[r];for(let o=t;o<r;++o){const r=o*At();r<t&&(e[0|r]=n[o])}return e}function Hs(t,e,n,r){const o=n.length;if(t>=o)return n;const s=new Float32Array(o),a=new Uint32Array(o);for(let t=0;t<o;++t)a[t]=t,s[t]=-Math.log(At())/r(n[t]);a.sort(((t,e)=>s[t]-s[e]));for(let r=0;r<t;++r)e[r]=n[a[r]];return e}function Ws(t,e,n,r={}){const{replace:o,shuffle:s}=r,a=t.partitions(!1);let i=0;e=a.map(((t,n)=>{let r=e(n);return i+=r=o?r:Math.min(t.length,r),r}));const u=new Uint32Array(i);let c=0;return a.forEach(((t,r)=>{const s=e[r],a=u.subarray(c,c+=s);o||s!==t.length?Vs(a,o,t,n):a.set(t)})),!1!==s&&(a.length>1||!o)&&function(t,e=0,n=t.length){let r=n-(e=+e);for(;r;){const n=At()*r--|0,o=t[r+e];t[r+e]=t[n+e],t[n+e]=o}}(u),t.reify(u)}const Ys=t=>e=>t.get(e)||0;function Qs(t,{names:e,exprs:n,ops:r=[]},o={}){if(0===e.length)return t;const s=1===e.length&&o.as||[],a=null==o.drop||!!o.drop,i=null==o.limit?s.length||1/0:Math.max(1,+o.limit||1),u=ss(t,r,n),c=nt(),l=e.reduce(((t,e,n)=>t.set(e,n)),new Map),f=(e,n)=>{const r=function(t,e,n){const r=t.totalRows(),o=[];return t.scan(((t,s)=>{const a=R(e(t,s)),i=Math.min(a.length,n);for(;o.length<i;)o.push(Array(r).fill(ot));for(let e=0;e<i;++e)o[e][t]=a[e]})),o}(t,u[e],i),o=r.length;for(let t=0;t<o;++t)c.add(s[t]||`${n}_${t+1}`,r[t])};return t.columnNames().forEach((e=>{l.has(e)?(a||c.add(e,t.column(e)),f(l.get(e),e),l.delete(e)):c.add(e,t.column(e))})),l.forEach(f),t.create(c)}function Ks(t,{names:e=[],exprs:n=[],ops:r=[]}){const o=e.length;if(0===o)return null;if(1===o&&!t.isFiltered()&&n[0].field){const r=t.column(n[0].field);if(r.groups)return r.groups(e)}let s=ss(t,r,n);const a=_e(s),i=t.totalRows(),u=new Uint32Array(i),c={},l=[],f=t.data(),p=t.mask();if(p)for(let t=p.next(0);t>=0;t=p.next(t+1)){const e=a(t,f)+"",n=c[e];u[t]=null!=n?n:c[e]=l.push(t)-1}else for(let t=0;t<i;++t){const e=a(t,f)+"",n=c[e];u[t]=null!=n?n:c[e]=l.push(t)-1}return r.length||(s=s.map((t=>e=>t(e,f)))),{keys:u,get:s,names:e,rows:l,size:l.length}}const Zs=(t,e,n,r)=>`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n    : (u > v || v == null) && u != null ? ${r}\n    : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n    : v !== v && u === u ? ${r} : `;var Xs={__antijoin:(t,e,n)=>Rs(t,e,n,{anti:!0}),__count:(t,e={})=>Ls(t,{[e.as||"count"]:Lt()}),__cross:(t,e,n,r)=>Is(t,e,(()=>!0),n,{...r,left:!0,right:!0}),__concat:function(t,e){const n=t.numRows(),r=n+e.reduce(((t,e)=>t+e.numRows()),0);if(n===r)return t;const o=[t,...e],s=nt();return t.columnNames().forEach((t=>{const e=Array(r);let n=0;o.forEach((r=>{const o=r.column(t)||{get:()=>ot};r.scan((t=>e[n++]=o.get(t)))})),s.add(t,e)})),t.create(s.new())},__dedupe:function(t,e=[]){return t.groupby(e.length?e:t.columnNames()).filter("row_number() === 1").ungroup().reify()},__derive:function(t,e,n={}){const r=ys(t,kr(e,{table:t}),n);return n.drop||null==n.before&&null==n.after?r:Yo(r,Object.keys(e).filter((e=>!t.column(e))),n)},__except:function(t,e){if(0===e.length)return t;const n=t.columnNames();return e.reduce(((t,e)=>t.antijoin(e.select(n))),t).dedupe()},__filter:function(t,e){const n=kr({p:e},{table:t});let r=n.exprs[0];if(n.ops.length){const{data:e}=ys(t,n,{drop:!0}).column("p");r=t=>e[t]}return function(t,e){const n=t.totalRows(),r=t.mask(),o=t.data(),s=new vs(n);if(r)for(let t=r.next(0);t>=0;t=r.next(t+1))e(t,o)&&s.set(t);else for(let t=0;t<n;++t)e(t,o)&&s.set(t);return t.create({filter:s})}(t,r)},__fold:function(t,e,n){return function(t,{names:e=[],exprs:n=[],ops:r=[]},o={}){if(0===e.length)return t;const[s="key",a="value"]=o.as||[],i=ss(t,r,n);return bs(t,{names:[s,a],exprs:[()=>e,(t,e)=>i.map((n=>n(t,e)))]},{...o,drop:e})}(t,ws("fold",t,e),n)},__impute:function(t,e,n={}){if((e=kr(e,{table:t})).names.forEach((e=>t.column(e)?0:P(`Invalid impute column ${Rt(e)}`))),n.expand){const r={preparse:Es,aggronly:!0},o=ws("impute",t,n.expand,r),s=$s(t.ungroup(),o);return xs(t,e,o.names,o.names.map((t=>s.get(t,0))))}return xs(t,e)},__intersect:function(t,e){const n=t.columnNames();return e.length?e.reduce(((t,e)=>t.semijoin(e.select(n))),t).dedupe():t.reify([])},__join:Is,__lookup:function(t,e,n,r){return function(t,e,[n,r],{names:o,exprs:s,ops:a}){const i=nt(t),u=t.totalRows();o.forEach((t=>i.add(t,Array(u).fill(ot))));const c=js(e,r),l=wo(["lr","rr","data"],"{"+Qo(o,((t,e)=>`_[${e}][lr] = $[${e}](rr, data);`))+"}",o.map((t=>i.data[t])),ss(e,a,s)),f=e.data();return t.scan(((t,e)=>{const r=c.get(n(t,e));r>=0&&l(t,r,f)})),t.create(i)}(t,e,[Os("lookup",t,(n=Ss(t,e,n))[0]),Os("lookup",e,n[1])],ws("lookup",e,r))},__pivot:function(t,e,n,r){return qs(t,ws("fold",t,e),ws("fold",t,n,{preparse:Ps,aggronly:!0}),r)},__relocate:Yo,__rename:function(t,e){const n=new Map;return t.columnNames((t=>(n.set(t,t),0))),Wo(t,bn(t,e,n))},__rollup:Ls,__sample:function(t,e,n={}){return Ws(t,function(t,e){return L(e)?()=>e:Ys($s(t,kr({size:e},{table:t,window:!1})).column("size"))}(t,e),function(t,e){return null==e?null:(e=L(e)?t.columnName(e):e,Ys(K(e)?t.column(e):ys(t,kr({w:e},{table:t}),{drop:!0}).column("w")))}(t,n.weight),n)},__select:function(t,e){return Wo(t,bn(t,e))},__semijoin:Rs,__spread:function(t,e,n){return Qs(t,ws("spread",t,e),n)},__union:function(t,e){return t.concat(e).dedupe()},__unroll:function(t,e,n){return bs(t,ws("unroll",t,e),n&&n.drop?{...n,drop:ws("unroll",t,n.drop).names}:n)},__groupby:function(t,e){return function(t,e){return t.create({groups:Ks(t,e)})}(t,ws("groupby",t,e))},__orderby:function(t,e){return function(t,e){return t.create({order:e})}(t,function(t,e){let n=-1;const r=new Map,o=t=>r.set(++n+"",t);return e.forEach((e=>{const n=null!=e.expr?e.expr:e;if(Y(n)&&!V(n))for(const t in n)o(n[t]);else o(L(n)?Jr(e,t.columnName(n)):K(n)?Jr(e):V(n)?e:P("Invalid orderby field: "+(e+"")))})),function(t,e){const n=[],r=[],o=[];let s=null,a="0",i="0";t.isGrouped()&&(s=t.groups().keys,a="ka",i="kb");const{ops:u}=kr(e,{table:t,value:(t,e)=>{if(n.push(t),e.escape){const t=t=>`fn[${o.length}](${t}, data)`;r.push([t("a"),t("b")]),o.push(e.escape)}else r.push([ge(e,{index:"a",op:a}),ge(e,{index:"b",op:i})])},window:!1}),c=as(t,u),l=(t,e)=>c[t][e],f=n.length;let p="return (a, b) => {"+(l&&t.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let t=0;t<f;++t){const o=e.get(n[t]).desc?-1:1,[s,a]=r[t];p+=Zs(s,a,-o,o)}return p+="0;};",Function("op","keys","fn","data",p)(l,s,o,t.data())}(t,r)}(t,e))},__ungroup:function(t){return t.isGrouped()?t.create({groups:null}):t},__unorder:function(t){return t.isOrdered()?t.create({order:null}):t},__reduce:function(t,e){const n=nt(),r=t.groups(),{get:o,names:s=[],rows:a,size:i=1}=r||{},u=new Uint32Array(i+1);s.forEach((t=>n.add(t,null)));const c=r?cs(t,e,r):[us(t,e)];e.outputs().map((t=>n.add(t,[])));const l=u.length-1;let f=0;for(let t=0;t<l;++t)f+=u[t+1]=e.write(c[t],n.data,u[t]);if(r){const e=t.data();s.forEach(((t,r)=>{const s=n.data[t]=Array(f),c=o[r];for(let t=0,n=0;t<i;++t)s.fill(c(a[t],e),n,n+=u[t+1])}))}return t.create(n.new())}};function ta(t,e){return An.new(t,e)}function ea(t,e){return An.from(t,e)}function na(t,e={}){const n=e.using||Bo;return fetch(t,e.fetch).then((t=>t[e.as||"text"]())).then((t=>n(t,e)))}function ra(t,e){return na(t,{...e,as:"arrayBuffer",using:Ao})}function oa(t,e){return na(t,{...e,as:"text",using:Bo})}function sa(t,e){return na(t,{...e,as:"text",using:Go})}function aa(t,e){return na(t,{...e,as:"json",using:ia})}function ia(t,e){return D(t)?ea(t):Ho(t,e)}function ua(t,e={}){const n=`d[${JSON.stringify(t)}]`,{maxbins:r,nice:o,minstep:s,step:a,offset:i}=e,u=[r,o,s,a];let c=u.length;for(;c&&null==u[--c];)u.pop();return`d => op.bin(${n}, ...op.bins(${n}${u.length?", "+u.map((t=>t+"")).join(", "):""}), ${i||0})`}function ca(t){return Vr(t,{escape:!0,toString(){P("Escaped values can not be serialized.")}})}function la(t){return`() => op.round(${+t} * op.count())`}function fa(...t){return t=t.flat(),e=>{const n=new Map,r=Math.min(t.length,e.numCols());for(let o=0;o<r;++o)n.set(e.columnName(o),t[o]);return n}}function pa(t,e){return t.ungroup().rollup({_:e}).get("_")}Object.assign(An.prototype,Xs);const ma=(t,e)=>P(`Illegal ${e} name: ${Rt(t)}`),da=(t,e)=>P(`The ${e} ${Rt(t)} is already defined. Use override option?`),ha=(t,e)=>P(`The ${e} name ${Rt(t)} is reserved and can not be overridden.`);function ga(t,e,n=Wt,r="function"){t||ma(t,r),!e.override&&et(n,t)&&da(t,r)}function ya(t,e,n,r){return n[t]===e||ga(t,r)}function _a(t,e,n,r={}){if(ya(t,e,n,r))return;const[o=0,s=0]=e.param;n[t]=e,Wt[t]=(...e)=>zt(t,e.slice(0,o),e.slice(o,o+s))}function va(t,e,n){_a(t,e,xe,n)}function ba(t,e,n){_a(t,e,Ee,n)}function wa(t,e,n={}){1===arguments.length&&(""===(t=(e=t).name)||"anonymous"===t?P("Anonymous function provided, please include a name argument."):t===Fe&&ha(Fe,"function")),ya(t,e,Ft,n)||(Ft[t]=e,Wt[t]=e)}const xa=An.prototype;let Ma;function $a(t){for(;t;t=Object.getPrototypeOf(t))Object.getOwnPropertyNames(t).forEach((t=>Ma[t]=1))}function Ea(t,e,n){const r="method";if(xa[t]&&xa[t].fn===e)return!0;Ma||(Ma={},$a(xa),$a(go.prototype)),Ma[t]&&ha(t,r),"_"===(t+"")[0]&&ma(t,r),ga(t,n,xa,r)}function ja(t,e,n={}){Ea(t,e,n)||(xa[t]=function(...t){return e(this,...t)},xa[t].fn=e)}function ka(t,e,n,r={}){ja(t,e,r),function(t,e){go.prototype[t]=function(...t){return _o(this,e(...t))}}(t,po[t]=fo(t,n))}function Na(t,e={}){const n=t&&t.arquero_package||t,r={functions:[(t,e,n)=>ya(t,e,Ft,n),wa],aggregateFunctions:[(t,e,n)=>ya(t,e,xe,n),va],windowFunctions:[(t,e,n)=>ya(t,e,Ee,n),ba],tableMethods:[Ea,ja],verbs:[(t,e,n)=>Ea(t,e.method,n),(t,e,n)=>ka(t,e.method,e.params,n)]};function o(t){for(const o in r){const s=r[o],a=n[o];for(const n in a)s[t](n,a[n],e)}}o(0),o(1)}const Aa={Table:G,ColumnTable:An,Transformable:q,Query:go,Reducer:Sn,Verb:lo,Verbs:po,columnFactory:function(t){return arguments.length?H=t:H},parse:kr,walk_ast:Tn},Oa=vo;export{va as addAggregateFunction,wa as addFunction,Na as addPackage,ja as addTableMethod,ka as addVerb,ba as addWindowFunction,pa as agg,Mn as all,ua as bin,Gr as desc,Nn as endswith,ca as escape,Jr as field,la as frac,ea as from,Ao as fromArrow,Bo as fromCSV,Go as fromFixed,Ho as fromJSON,Aa as internal,na as load,ra as loadArrow,oa as loadCSV,sa as loadFixed,aa as loadJSON,jn as matches,fa as names,$n as not,Wt as op,mo as query,ho as queryFrom,En as range,Hr as rolling,Ot as seed,kn as startswith,ta as table,cn as toArrow,Oa as version};export default null;
